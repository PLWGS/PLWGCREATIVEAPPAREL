<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Size Chart System Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #1a1a1a; color: #fff; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #333; border-radius: 8px; }
        .pass { color: #10b981; }
        .fail { color: #ef4444; }
        .info { color: #3b82f6; }
    </style>
</head>
<body class="p-8">
    <h1 class="text-3xl font-bold mb-8">Size Chart System - Test Results</h1>
    
    <div class="test-section">
        <h2 class="text-xl font-semibold mb-4">Test 1: Admin Interface Size Chart Section</h2>
        <div id="test1-result">Testing...</div>
        <div class="mt-4">
            <a href="/pages/admin-uploads.html" target="_blank" class="text-blue-400 underline">→ Open Admin Upload Page</a>
        </div>
    </div>
    
    <div class="test-section">
        <h2 class="text-xl font-semibold mb-4">Test 2: Database Size Chart Column</h2>
        <div id="test2-result">Testing...</div>
    </div>
    
    <div class="test-section">
        <h2 class="text-xl font-semibold mb-4">Test 3: Create Product with Size Chart</h2>
        <div id="test3-result">Testing...</div>
        <button id="test3-btn" class="mt-2 px-4 py-2 bg-blue-600 rounded hover:bg-blue-700">Run Test</button>
    </div>
    
    <div class="test-section">
        <h2 class="text-xl font-semibold mb-4">Test 4: Product Display Size Chart</h2>
        <div id="test4-result">Testing...</div>
        <div class="mt-4">
            <a href="/pages/product.html?name=Test Size Chart Product" target="_blank" class="text-blue-400 underline">→ Open Test Product Page</a>
        </div>
    </div>
    
    <div class="test-section">
        <h2 class="text-xl font-semibold mb-4">Test 5: Size Chart Presets</h2>
        <div id="test5-result">Testing...</div>
        <div class="mt-4">
            <h3 class="font-semibold">Expected Preset Values:</h3>
            <div class="mt-2 text-sm space-y-1">
                <div><strong>Adult T-Shirt:</strong> S: 18"×28", M: 20"×29", L: 22"×30", XL: 24"×31", 2XL: 26"×32"</div>
                <div><strong>Adult Hoodie:</strong> S: 20"×26", M: 22"×27", L: 24"×28", XL: 26"×29", 2XL: 28"×30"</div>
                <div><strong>Kids T-Shirt:</strong> S: 14"×19", M: 15"×20", L: 16"×21", XL: 17"×22", 2XL: 18"×23"</div>
                <div><strong>Kids Hoodie:</strong> S: 15"×18", M: 16"×19", L: 17"×20", XL: 18"×21", 2XL: 19"×22"</div>
            </div>
        </div>
    </div>

    <script>
        // Test 1: Check if admin interface has size chart elements
        function test1() {
            fetch('/pages/admin-uploads.html')
                .then(response => response.text())
                .then(html => {
                    const hasGarmentType = html.includes('id="garment-type"');
                    const hasSizeInputs = html.includes('id="size-s-chest"') && html.includes('id="size-m-length"');
                    const hasSizeChartSection = html.includes('Size Chart Configuration');
                    
                    if (hasGarmentType && hasSizeInputs && hasSizeChartSection) {
                        document.getElementById('test1-result').innerHTML = '<span class="pass">✅ PASS</span> - Admin interface has all size chart elements';
                    } else {
                        document.getElementById('test1-result').innerHTML = '<span class="fail">❌ FAIL</span> - Missing size chart elements in admin interface';
                    }
                })
                .catch(err => {
                    document.getElementById('test1-result').innerHTML = '<span class="fail">❌ ERROR</span> - Could not load admin page: ' + err.message;
                });
        }

        // Test 2: Check database structure
        function test2() {
            fetch('/api/products?limit=1')
                .then(response => response.json())
                .then(data => {
                    if (data.products && data.products.length > 0) {
                        const product = data.products[0];
                        const hasSizeChart = 'size_chart' in product;
                        
                        if (hasSizeChart) {
                            document.getElementById('test2-result').innerHTML = '<span class="pass">✅ PASS</span> - Database has size_chart column';
                        } else {
                            document.getElementById('test2-result').innerHTML = '<span class="fail">❌ FAIL</span> - Database missing size_chart column';
                        }
                    } else {
                        document.getElementById('test2-result').innerHTML = '<span class="info">ℹ️ INFO</span> - No products found to test database structure';
                    }
                })
                .catch(err => {
                    document.getElementById('test2-result').innerHTML = '<span class="fail">❌ ERROR</span> - Could not check database: ' + err.message;
                });
        }

        // Test 3: Create test product with size chart
        function test3() {
            const testProduct = {
                name: "Test Size Chart Product",
                description: "Testing size chart functionality",
                price: 25.00,
                category: "T-Shirts",
                colors: ["Black"],
                sizes: ["S", "M", "L", "XL", "2XL"],
                size_chart: {
                    S: { chest: "18", length: "28" },
                    M: { chest: "20", length: "29" },
                    L: { chest: "22", length: "30" },
                    XL: { chest: "24", length: "31" },
                    "2XL": { chest: "26", length: "32" }
                }
            };

            fetch('/api/admin/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer test-token' // You may need to get a real token
                },
                body: JSON.stringify(testProduct)
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Failed to create product: ' + response.status);
                }
            })
            .then(data => {
                document.getElementById('test3-result').innerHTML = '<span class="pass">✅ PASS</span> - Test product created successfully with ID: ' + data.id;
            })
            .catch(err => {
                document.getElementById('test3-result').innerHTML = '<span class="fail">❌ FAIL</span> - Could not create test product: ' + err.message;
            });
        }

        // Test 4: Check product display
        function test4() {
            fetch('/pages/product.html')
                .then(response => response.text())
                .then(html => {
                    const hasSizeChartTbody = html.includes('id="size-chart-tbody"');
                    const hasUpdateFunction = html.includes('function updateSizeChart');
                    const hasChestWidthHeader = html.includes('Chest Width');
                    const noShoulderHeader = !html.includes('Shoulder');
                    
                    if (hasSizeChartTbody && hasUpdateFunction && hasChestWidthHeader && noShoulderHeader) {
                        document.getElementById('test4-result').innerHTML = '<span class="pass">✅ PASS</span> - Product page has updated size chart structure';
                    } else {
                        document.getElementById('test4-result').innerHTML = '<span class="fail">❌ FAIL</span> - Product page size chart structure incomplete';
                    }
                })
                .catch(err => {
                    document.getElementById('test4-result').innerHTML = '<span class="fail">❌ ERROR</span> - Could not load product page: ' + err.message;
                });
        }

        // Test 5: Manual test note
        function test5() {
            document.getElementById('test5-result').innerHTML = '<span class="info">ℹ️ MANUAL</span> - Please test presets manually in admin interface using the link above';
        }

        // Run tests
        document.addEventListener('DOMContentLoaded', function() {
            test1();
            test2();
            test4();
            test5();
            
            document.getElementById('test3-btn').addEventListener('click', test3);
        });
    </script>
<script id="dhws-dataInjector" src="/public/dhws-data-injector.js"></script>
</body>
</html>
