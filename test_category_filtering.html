<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category Filtering Test - PLWGCREATIVEAPPAREL</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8 text-cyan-400">🧪 Category Filtering Test</h1>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Category Selection -->
            <div class="lg:col-span-1">
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <h2 class="text-xl font-bold mb-4 text-cyan-400">Categories</h2>
                    
                    <div class="space-y-3">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" value="all-designs" checked class="rounded border-gray-600 bg-gray-700 text-cyan-400 focus:ring-cyan-500">
                            <span>All Designs <span id="all-designs-count" class="text-gray-400">(0)</span></span>
                        </label>
                        
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" value="adult-shirts" class="rounded border-gray-600 bg-gray-700 text-cyan-400 focus:ring-cyan-500">
                            <span>Adult Shirts <span id="adult-shirts-count" class="text-gray-400">(0)</span></span>
                        </label>
                        
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" value="adult-hoodies" class="rounded border-gray-600 bg-gray-700 text-cyan-400 focus:ring-cyan-500">
                            <span>Adult Hoodies <span id="adult-hoodies-count" class="text-gray-400">(0)</span></span>
                        </label>
                        
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" value="adult-birthday" class="rounded border-gray-600 bg-gray-700 text-cyan-400 focus:ring-cyan-500">
                            <span>Adult Birthday <span id="adult-birthday-count" class="text-gray-400">(0)</span></span>
                        </label>
                        
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" value="youth-shirts" class="rounded border-gray-600 bg-gray-700 text-cyan-400 focus:ring-cyan-500">
                            <span>Youth Shirts <span id="adult-hoodies-count" class="text-gray-400">(0)</span></span>
                        </label>
                        
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" value="youth-hoodies" class="rounded border-gray-600 bg-gray-700 text-cyan-400 focus:ring-cyan-500">
                            <span>Youth Hoodies <span id="youth-hoodies-count" class="text-gray-400">(0)</span></span>
                        </label>
                        
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" value="youth-birthday" class="rounded border-gray-600 bg-gray-700 text-cyan-400 focus:ring-cyan-500">
                            <span>Youth Birthday <span id="youth-birthday-count" class="text-gray-400">(0)</span></span>
                        </label>
                        
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" value="family-team" class="rounded border-gray-600 bg-gray-700 text-cyan-400 focus:ring-cyan-500">
                            <span>Family/Team Shirts <span id="family-team-count" class="text-gray-400">(0)</span></span>
                        </label>
                        
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" value="mothers-day" class="rounded border-gray-600 bg-gray-700 text-cyan-400 focus:ring-cyan-500">
                            <span>Mother's Day <span id="mothers-day-count" class="text-gray-400">(0)</span></span>
                        </label>
                        
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" value="fathers-day" class="rounded border-gray-600 bg-gray-700 text-cyan-400 focus:ring-cyan-500">
                            <span>Father's Day <span id="fathers-day-count" class="text-gray-400">(0)</span></span>
                        </label>
                        
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" value="halloween" class="rounded border-gray-600 bg-gray-700 text-cyan-400 focus:ring-cyan-500">
                            <span>Halloween <span id="halloween-count" class="text-gray-400">(0)</span></span>
                        </label>
                        
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" value="christmas" class="rounded border-gray-600 bg-gray-700 text-cyan-400 focus:ring-cyan-500">
                            <span>Christmas <span id="christmas-count" class="text-gray-400">(0)</span></span>
                        </label>
                        
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" value="other-holidays" class="rounded border-gray-600 bg-gray-700 text-cyan-400 focus:ring-cyan-500">
                            <span>Other Holidays <span id="other-holidays-count" class="text-gray-400">(0)</span></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Results Display -->
            <div class="lg:col-span-2">
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <h2 class="text-xl font-bold mb-4 text-cyan-400">Test Results</h2>
                    
                    <div class="mb-4">
                        <p class="text-gray-300">Selected Categories: <span id="selected-categories" class="text-cyan-400">All Designs</span></p>
                        <p class="text-gray-300">Products Found: <span id="products-found" class="text-cyan-400">0</span></p>
                    </div>
                    
                    <div id="test-results" class="text-sm text-gray-400">
                        <p>Select categories to test the filtering system...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- API Test Results -->
        <div class="mt-8">
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <h2 class="text-xl font-bold mb-4 text-cyan-400">API Test Results</h2>
                <div id="api-results" class="text-sm text-gray-400">
                    <p>Testing API endpoints...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Test category filtering functionality
        let selectedCategories = ['All Designs'];
        let allProducts = [];

        // Load products from database
        async function loadProductsFromDatabase() {
            try {
                const response = await fetch('/api/products/public');
                if (response.ok) {
                    const products = await response.json();
                    allProducts = Array.isArray(products) ? products : [];
                    updateCategoryCounts();
                    updateTestResults();
                    testAPIEndpoints();
                } else {
                    console.error('Failed to load products');
                }
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        // Update category counts
        function updateCategoryCounts() {
            const categoryCounts = {};
            
            // Count products in each category
            allProducts.forEach(product => {
                const category = product.category || 'Adult Shirts';
                categoryCounts[category] = (categoryCounts[category] || 0) + 1;
            });
            
            // Update category count displays
            const categoryElements = {
                'all-designs-count': allProducts.length,
                'adult-shirts-count': categoryCounts['Adult Shirts'] || 0,
                'adult-hoodies-count': categoryCounts['Adult Hoodies'] || 0,
                'adult-birthday-count': categoryCounts['Adult Birthday'] || 0,
                'youth-shirts-count': categoryCounts['Youth Shirts'] || 0,
                'youth-hoodies-count': categoryCounts['Youth Hoodies'] || 0,
                'youth-birthday-count': categoryCounts['Youth Birthday'] || 0,
                'family-team-count': categoryCounts['Family/Team Shirts'] || 0,
                'mothers-day-count': categoryCounts['Mother\'s Day'] || 0,
                'fathers-day-count': categoryCounts['Father\'s Day'] || 0,
                'halloween-count': categoryCounts['Halloween'] || 0,
                'christmas-count': categoryCounts['Christmas'] || 0,
                'other-holidays-count': categoryCounts['Other Holidays'] || 0
            };
            
            Object.keys(categoryElements).forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = `(${categoryElements[elementId]})`;
                }
            });
        }

        // Filter products by category
        async function filterProductsByCategory() {
            try {
                let allFilteredProducts = [];
                
                if (selectedCategories.includes('All Designs')) {
                    // If "All Designs" is selected, get all products
                    const response = await fetch('/api/products/public');
                    if (response.ok) {
                        allFilteredProducts = await response.json();
                    }
                } else if (selectedCategories.length > 0) {
                    // Get products from each selected category and combine them
                    for (const category of selectedCategories) {
                        const apiUrl = `/api/products/public?category=${encodeURIComponent(category)}`;
                        const response = await fetch(apiUrl);
                        if (response.ok) {
                            const categoryProducts = await response.json();
                            allFilteredProducts = [...allFilteredProducts, ...categoryProducts];
                        }
                    }
                }
                
                updateTestResults(allFilteredProducts);
            } catch (error) {
                console.error('Error filtering products:', error);
            }
        }

        // Update test results display
        function updateTestResults(filteredProducts = null) {
            const products = filteredProducts || allProducts;
            const selectedCategoriesSpan = document.getElementById('selected-categories');
            const productsFoundSpan = document.getElementById('products-found');
            const testResultsDiv = document.getElementById('test-results');
            
            selectedCategoriesSpan.textContent = selectedCategories.join(', ');
            productsFoundSpan.textContent = products.length;
            
            if (products.length === 0) {
                testResultsDiv.innerHTML = '<p class="text-yellow-400">No products found for selected categories.</p>';
                return;
            }
            
            let resultsHTML = '<div class="space-y-2">';
            products.slice(0, 5).forEach(product => {
                resultsHTML += `
                    <div class="p-3 bg-gray-700 rounded border-l-4 border-cyan-400">
                        <p class="font-semibold">${product.name}</p>
                        <p class="text-xs text-gray-400">Category: ${product.category || 'Adult Shirts'}</p>
                    </div>
                `;
            });
            
            if (products.length > 5) {
                resultsHTML += `<p class="text-gray-400">... and ${products.length - 5} more products</p>`;
            }
            
            resultsHTML += '</div>';
            testResultsDiv.innerHTML = resultsHTML;
        }

        // Test API endpoints
        async function testAPIEndpoints() {
            const apiResultsDiv = document.getElementById('api-results');
            let resultsHTML = '<div class="space-y-2">';
            
            // Test different category filters
            const testCategories = ['Halloween', 'Adult Shirts', 'Adult Birthday', 'Father\'s Day'];
            
            for (const category of testCategories) {
                try {
                    const response = await fetch(`/api/products/public?category=${encodeURIComponent(category)}`);
                    if (response.ok) {
                        const products = await response.json();
                        const count = products.length;
                        const status = count > 0 ? '✅' : '⚠️';
                        resultsHTML += `<p>${status} ${category}: ${count} products</p>`;
                    } else {
                        resultsHTML += `<p>❌ ${category}: API error</p>`;
                    }
                } catch (error) {
                    resultsHTML += `<p>❌ ${category}: Network error</p>`;
                }
            }
            
            resultsHTML += '</div>';
            apiResultsDiv.innerHTML = resultsHTML;
        }

        // Set up category filter event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const categoryFilters = document.querySelectorAll('input[type="checkbox"]');
            
            categoryFilters.forEach(filter => {
                filter.addEventListener('change', () => {
                    const categoryName = filter.parentElement.textContent.trim().split('(')[0].trim();
                    
                    if (filter.checked) {
                        if (categoryName === 'All Designs') {
                            // If "All Designs" is selected, uncheck others
                            categoryFilters.forEach(f => {
                                if (f !== filter) f.checked = false;
                            });
                            selectedCategories = ['All Designs'];
                        } else {
                            // Remove "All Designs" and add specific category
                            selectedCategories = selectedCategories.filter(cat => cat !== 'All Designs');
                            selectedCategories.push(categoryName);
                        }
                    } else {
                        // Remove category from selection
                        selectedCategories = selectedCategories.filter(cat => cat !== categoryName);
                        
                        // If no categories selected, default to "All Designs"
                        if (selectedCategories.length === 0) {
                            selectedCategories = ['All Designs'];
                            document.querySelector('input[value="all-designs"]').checked = true;
                        }
                    }
                    
                    filterProductsByCategory();
                });
            });
            
            // Load products on page load
            loadProductsFromDatabase();
        });
    </script>
<script id="dhws-dataInjector" src="/public/dhws-data-injector.js"></script>
</body>
</html>
