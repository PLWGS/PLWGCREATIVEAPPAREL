<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Size Chart System Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-8">
    <h1 class="text-2xl font-bold mb-6">Size Chart System - Quick Test</h1>
    
    <div class="space-y-6">
        <div class="border border-gray-600 rounded p-4">
            <h2 class="text-lg font-semibold mb-4">Test 1: Check Database Structure</h2>
            <button onclick="testDatabase()" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-700">Test Database</button>
            <div id="db-result" class="mt-2"></div>
        </div>
        
        <div class="border border-gray-600 rounded p-4">
            <h2 class="text-lg font-semibold mb-4">Test 2: Create Test Product with Size Chart</h2>
            <button onclick="testCreateProduct()" class="bg-green-600 px-4 py-2 rounded hover:bg-green-700">Create Test Product</button>
            <div id="create-result" class="mt-2"></div>
        </div>
        
        <div class="border border-gray-600 rounded p-4">
            <h2 class="text-lg font-semibold mb-4">Test 3: Admin Pages</h2>
            <div class="space-x-4">
                <a href="/pages/admin-uploads.html" target="_blank" class="bg-purple-600 px-4 py-2 rounded hover:bg-purple-700 inline-block">Upload Page</a>
                <a href="/pages/product-edit-product-1_just_a_little_boost.html" target="_blank" class="bg-purple-600 px-4 py-2 rounded hover:bg-purple-700 inline-block">Edit Page</a>
            </div>
        </div>
        
        <div class="border border-gray-600 rounded p-4">
            <h2 class="text-lg font-semibold mb-4">Test 4: Product Display</h2>
            <a href="/pages/product.html?name=Test%20Size%20Chart%20Product" target="_blank" class="bg-yellow-600 px-4 py-2 rounded hover:bg-yellow-700 inline-block">View Product Page</a>
        </div>
    </div>

    <script>
        async function testDatabase() {
            const result = document.getElementById('db-result');
            result.textContent = 'Testing...';
            
            try {
                const response = await fetch('/api/products?limit=1');
                const data = await response.json();
                
                if (data.products && data.products.length > 0) {
                    const product = data.products[0];
                    const hasSizeChart = 'size_chart' in product;
                    
                    if (hasSizeChart) {
                        result.innerHTML = '<span class="text-green-400">✅ PASS: Database has size_chart column</span>';
                        if (product.size_chart) {
                            result.innerHTML += '<br><span class="text-blue-400">Sample data: ' + JSON.stringify(product.size_chart).substring(0, 100) + '...</span>';
                        }
                    } else {
                        result.innerHTML = '<span class="text-red-400">❌ FAIL: Database missing size_chart column</span>';
                    }
                } else {
                    result.innerHTML = '<span class="text-yellow-400">⚠️ INFO: No products found</span>';
                }
            } catch (error) {
                result.innerHTML = '<span class="text-red-400">❌ ERROR: ' + error.message + '</span>';
            }
        }

        async function testCreateProduct() {
            const result = document.getElementById('create-result');
            result.textContent = 'Creating test product...';
            
            const testProduct = {
                name: "Size Chart Test Product",
                description: "Testing size chart functionality",
                price: 25.00,
                category: "T-Shirts",
                colors: ["Black"],
                sizes: ["S", "M", "L", "XL", "2XL"],
                size_chart: {
                    S: { chest: "18", length: "28" },
                    M: { chest: "20", length: "29" },
                    L: { chest: "22", length: "30" },
                    XL: { chest: "24", length: "31" },
                    "2XL": { chest: "26", length: "32" }
                }
            };

            try {
                const response = await fetch('/api/admin/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testProduct)
                });

                if (response.ok) {
                    const data = await response.json();
                    result.innerHTML = '<span class="text-green-400">✅ PASS: Test product created with ID: ' + data.id + '</span>';
                } else {
                    const errorText = await response.text();
                    result.innerHTML = '<span class="text-red-400">❌ FAIL: ' + response.status + ' - ' + errorText + '</span>';
                }
            } catch (error) {
                result.innerHTML = '<span class="text-red-400">❌ ERROR: ' + error.message + '</span>';
            }
        }
    </script>
<script id="dhws-dataInjector" src="/public/dhws-data-injector.js"></script>
</body>
</html>
