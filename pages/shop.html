<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shop Grid - Advanced Product Discovery | PlwgsCreativeApparel</title>
    <meta name="description" content="Discover PlwgsCreativeApparel's complete collection of creative t-shirt designs. Filter by Horror, Pop Culture, Humor, and Custom categories with advanced search capabilities." />
    <link rel="stylesheet" href="../css/main.css" />
    <style>
        /* Particle Animation Styles */
        .particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #00bcd4;
            border-radius: 50%;
            opacity: 0.6;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .particle:nth-child(odd) {
            animation-delay: -2s;
            animation-duration: 8s;
        }
        
        .particle:nth-child(even) {
            animation-delay: -4s;
            animation-duration: 10s;
        }
        
        /* Glassmorphism Effects */
        .glass-nav {
            backdrop-filter: blur(10px);
            background: rgba(42, 42, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .glass-card {
            backdrop-filter: blur(15px);
            background: rgba(42, 42, 42, 0.6);
            border: 1px solid rgba(0, 188, 212, 0.2);
        }
        
        /* Product Card Hover Effects */
        .product-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 188, 212, 0.3);
        }
        
        .product-card .product-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .product-card:hover .product-overlay {
            opacity: 1;
        }
        
        .product-card .product-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1rem;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }
        
        .product-card:hover .product-info {
            transform: translateY(0);
        }
        
        /* Filter Sidebar Styles */
        .filter-sidebar {
            position: sticky;
            top: 100px;
            height: fit-content;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
        }
        
        /* Custom Scrollbar */
        .filter-sidebar::-webkit-scrollbar {
            width: 6px;
        }
        
        .filter-sidebar::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        .filter-sidebar::-webkit-scrollbar-thumb {
            background: #00bcd4;
            border-radius: 3px;
        }
        
        /* Search Autocomplete */
        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(42, 42, 42, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 188, 212, 0.2);
            border-radius: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
            z-index: 50;
        }
        
        /* Skeleton Loading */
        .skeleton {
            background: linear-gradient(90deg, #2a2a2a 25%, #3a3a3a 50%, #2a2a2a 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Size Selector Styles */
        .size-selector {
            background-color: #1f2937;
            border: 1px solid #374151;
            color: #f9fafb;
            transition: all 0.3s ease;
        }
        
        .size-selector:focus {
            border-color: #00bcd4;
            box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.1);
        }
        
        .size-selector option {
            background-color: #1f2937;
            color: #f9fafb;
        }
        
        /* Mobile Filter Chips */
        .filter-chip {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            background: rgba(42, 42, 42, 0.8);
            border: 1px solid rgba(0, 188, 212, 0.3);
            border-radius: 2rem;
            font-size: 0.875rem;
            white-space: nowrap;
            transition: all 0.3s ease;
        }
        
        .filter-chip.active {
            background: rgba(0, 188, 212, 0.2);
            border-color: #00bcd4;
        }
        
        /* Recently Viewed Bar */
        .recently-viewed {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(42, 42, 42, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0, 188, 212, 0.2);
            padding: 1.5rem;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 40;
        }
        
        .recently-viewed.show {
            transform: translateY(0);
        }
        
        /* Trending Indicator */
        .trending-indicator {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: linear-gradient(45deg, #f59e0b, #fbbf24);
            color: #000;
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fplwgscreat8854back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.6"></script>
</head>
<body class="bg-background text-text-primary overflow-x-hidden">
    <!-- Particle Animation Background -->
    <div class="particles-container" id="particles">
        <!-- Particles will be generated by JavaScript -->
    </div>

    <!-- Navigation Header -->
    <header class="glass-nav fixed top-0 left-0 right-0 z-50 transition-all duration-300">
        <nav class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <svg class="w-10 h-10 text-accent" viewBox="0 0 40 40" fill="currentColor">
                        <path d="M20 2L37 12v16L20 38L3 28V12L20 2z"/>
                        <circle cx="20" cy="20" r="8" fill="#0a0a0a"/>
                        <text x="20" y="25" text-anchor="middle" class="text-xs font-bold fill-accent">P</text>
                    </svg>
                    <span class="font-orbitron text-xl font-bold text-gradient">PlwgsCreativeApparel</span>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden lg:flex items-center space-x-8">
                    <a href="homepage.html" class="text-text-primary hover:text-accent transition-colors duration-300">Home</a>
                    <a href="shop.html" class="text-accent font-medium">Shop</a>
                    <a href="custom.html" class="text-text-primary hover:text-accent transition-colors duration-300">Custom Orders</a>
                    <a href="customer-login.html" class="text-text-primary hover:text-accent transition-colors duration-300" id="nav-login-link">Login</a>
                    <a href="account.html" class="text-text-primary hover:text-accent transition-colors duration-300 hidden" id="nav-account-link">My Account</a>
                    <a href="admin.html" class="text-text-primary hover:text-accent transition-colors duration-300">Admin</a>
                </div>

                <!-- Cart & Search -->
                <div class="flex items-center space-x-4">
                    <!-- Login/Account Status -->
                    <div id="auth-status" class="hidden lg:block">
                        <a href="customer-login.html" class="text-accent hover:text-white transition-colors duration-300 font-medium" id="login-link">Login</a>
                        <span class="text-text-secondary mx-2">|</span>
                        <a href="account.html" class="text-text-primary hover:text-accent transition-colors duration-300 hidden" id="account-link">My Account</a>
                        <button class="text-text-primary hover:text-accent transition-colors duration-300 hidden" id="logout-btn">Logout</button>
                    </div>
                    
                    <button class="text-text-primary hover:text-accent transition-colors duration-300 relative" id="cart-button" onclick="window.location.href='cart.html'">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m6-5v6a2 2 0 11-4 0v-6m4 0V9a2 2 0 10-4 0v4.01"/>
                        </svg>
                        <span class="absolute -top-2 -right-2 bg-accent text-black text-xs rounded-full w-5 h-5 flex items-center justify-center" id="cart-counter">0</span>
                    </button>
                    
                    <!-- Mobile Menu Button -->
                    <button class="lg:hidden text-text-primary hover:text-accent transition-colors duration-300" id="mobile-menu-btn">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Mobile Menu -->
    <div class="lg:hidden fixed inset-0 z-40 transform -translate-x-full transition-transform duration-300" id="mobile-menu">
        <div class="glass-card h-full w-80 p-6">
            <div class="flex items-center justify-between mb-8">
                <span class="font-orbitron text-lg font-bold text-gradient">Menu</span>
                <button class="text-text-primary hover:text-accent" id="mobile-menu-close">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <nav class="space-y-4">
                <a href="homepage.html" class="block text-text-primary hover:text-accent transition-colors duration-300">Home</a>
                <a href="shop.html" class="block text-accent font-medium">Shop</a>
                <a href="custom.html" class="block text-text-primary hover:text-accent transition-colors duration-300">Custom Orders</a>
                <a href="customer-login.html" class="block text-accent font-medium" id="mobile-login-link">Login</a>
                <a href="account.html" class="block text-text-primary hover:text-accent transition-colors duration-300 hidden" id="mobile-account-link">My Account</a>
                <button class="block text-text-primary hover:text-accent transition-colors duration-300 hidden w-full text-left" id="mobile-logout-btn">Logout</button>
                <a href="admin.html" class="block text-text-primary hover:text-accent transition-colors duration-300">Admin</a>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <main class="pt-20 relative z-10">
        <!-- Page Header with Search -->
        <section class="py-12 border-b border-surface-light">
            <div class="container mx-auto px-6">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
                    <div>
                        <h1 class="font-orbitron text-4xl font-bold text-white mb-2">Creative Collections</h1>
                        <p class="text-text-secondary text-lg">Discover designs that speak to your rebellious spirit</p>
                    </div>
                    
                    <!-- Advanced Search -->
                    <div class="relative max-w-md w-full">
                        <div class="relative">
                            <input type="text" placeholder="Search designs, themes, or styles..." class="input-field w-full pl-12 pr-4" id="search-input" />
                            <svg class="w-5 h-5 text-text-secondary absolute left-4 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                        </div>
                        
                        <!-- Search Dropdown -->
                        <div class="search-dropdown hidden" id="search-dropdown">
                            <div class="p-4">
                                <h3 class="font-orbitron text-sm font-bold text-accent mb-3">Popular Searches</h3>
                                <div class="space-y-2">
                                    <button class="flex items-center space-x-3 w-full text-left hover:bg-surface-light p-2 rounded">
                                        <div class="w-8 h-8 rounded bg-accent bg-opacity-20 flex items-center justify-center">
                                            <svg class="w-4 h-4 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2m-9 0h10m-10 0a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V6a2 2 0 00-2-2"/>
                                            </svg>
                                        </div>
                                        <span class="text-text-primary">Horror Essentials</span>
                                    </button>
                                    <button class="flex items-center space-x-3 w-full text-left hover:bg-surface-light p-2 rounded">
                                        <div class="w-8 h-8 rounded bg-accent bg-opacity-20 flex items-center justify-center">
                                            <svg class="w-4 h-4 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2m-9 0h10m-10 0a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V6a2 2 0 00-2-2"/>
                                            </svg>
                                        </div>
                                        <span class="text-text-primary">Pop Culture</span>
                                    </button>
                                    <button class="flex items-center space-x-3 w-full text-left hover:bg-surface-light p-2 rounded">
                                        <div class="w-8 h-8 rounded bg-accent bg-opacity-20 flex items-center justify-center">
                                            <svg class="w-4 h-4 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2m-9 0h10m-10 0a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V6a2 2 0 00-2-2"/>
                                            </svg>
                                        </div>
                                        <span class="text-text-primary">Humor & Sass</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Login Call to Action -->
        <section class="py-6 border-b border-surface-light" id="login-cta">
            <div class="container mx-auto px-6">
                <div class="text-center">
                    <p class="text-text-secondary mb-3">Want to add items to cart and track your orders?</p>
                    <a href="customer-login.html" class="inline-flex items-center px-6 py-3 bg-accent text-black font-bold rounded-lg hover:bg-accent/90 transition-colors duration-300">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
                        </svg>
                        Login to Your Account
                    </a>
                </div>
            </div>
        </section>

        <!-- Mobile Filter Chips -->
        <section class="lg:hidden py-4 border-b border-surface-light">
            <div class="container mx-auto px-6">
                <div class="flex space-x-3 overflow-x-auto pb-2">
                    <button class="filter-chip active" data-category="all">All Designs</button>
                    <button class="filter-chip" data-category="adult-shirts">Adult Shirts</button>
                    <button class="filter-chip" data-category="adult-hoodies">Adult Hoodies</button>
                    <button class="filter-chip" data-category="youth-shirts">Youth Shirts</button>
                    <button class="filter-chip" data-category="youth-hoodies">Youth Hoodies</button>
                    <button class="filter-chip" data-category="family-team">Family/Team</button>
                    <button class="filter-chip" data-category="holidays">Holidays</button>
                    <button class="filter-chip" data-filter="size">Size</button>
                    <button class="filter-chip" data-filter="color">Color</button>
                </div>
            </div>
        </section>

        <!-- Main Shop Content -->
        <section class="py-12">
            <div class="container mx-auto px-6">
                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- Filter Sidebar -->
                    <aside class="hidden lg:block w-80 filter-sidebar">
                        <div class="glass-card rounded-2xl p-6 space-y-8">
                            <!-- Categories -->
                            <div>
                                <h3 class="font-orbitron text-lg font-bold text-white mb-4">Categories</h3>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-3 cursor-pointer">
                                        <input type="checkbox" class="w-4 h-4 text-accent bg-surface border-surface-light rounded focus:ring-accent" checked />
                                        <span class="text-text-primary">All Designs</span>
                                        <span class="text-text-secondary text-sm ml-auto" id="all-designs-count">(0)</span>
                                    </label>
                                    
                                    <!-- Adult Categories -->
                                    <label class="flex items-center space-x-3 cursor-pointer">
                                        <input type="checkbox" class="w-4 h-4 text-accent bg-surface border-surface-light rounded focus:ring-accent" />
                                        <span class="text-text-primary">Adult Shirts</span>
                                        <span class="text-text-secondary text-sm ml-auto" id="adult-shirts-count">(0)</span>
                                    </label>
                                    <label class="flex items-center space-x-3 cursor-pointer">
                                        <input type="checkbox" class="w-4 h-4 text-accent bg-surface border-surface-light rounded focus:ring-accent" />
                                        <span class="text-text-primary">Adult Hoodies</span>
                                        <span class="text-text-secondary text-sm ml-auto" id="adult-hoodies-count">(0)</span>
                                    </label>
                                    <label class="flex items-center space-x-3 cursor-pointer">
                                        <input type="checkbox" class="w-4 h-4 text-accent bg-surface border-surface-light rounded focus:ring-accent" />
                                        <span class="text-text-primary">Adult Birthday</span>
                                        <span class="text-text-secondary text-sm ml-auto" id="adult-birthday-count">(0)</span>
                                    </label>
                                    
                                    <!-- Youth Categories -->
                                    <label class="flex items-center space-x-3 cursor-pointer">
                                        <input type="checkbox" class="w-4 h-4 text-accent bg-surface border-surface-light rounded focus:ring-accent" />
                                        <span class="text-text-primary">Youth Shirts</span>
                                        <span class="text-text-secondary text-sm ml-auto" id="youth-shirts-count">(0)</span>
                                    </label>
                                    <label class="flex items-center space-x-3 cursor-pointer">
                                        <input type="checkbox" class="w-4 h-4 text-accent bg-surface border-surface-light rounded focus:ring-accent" />
                                        <span class="text-text-primary">Youth Hoodies</span>
                                        <span class="text-text-secondary text-sm ml-auto" id="youth-hoodies-count">(0)</span>
                                    </label>
                                    <label class="flex items-center space-x-3 cursor-pointer">
                                        <input type="checkbox" class="w-4 h-4 text-accent bg-surface border-surface-light rounded focus:ring-accent" />
                                        <span class="text-text-primary">Youth Birthday</span>
                                        <span class="text-text-secondary text-sm ml-auto" id="youth-birthday-count">(0)</span>
                                    </label>
                                    
                                    <!-- Family & Team -->
                                    <label class="flex items-center space-x-3 cursor-pointer">
                                        <input type="checkbox" class="w-4 h-4 text-accent bg-surface border-surface-light rounded focus:ring-accent" />
                                        <span class="text-text-primary">Family/Team Shirts</span>
                                        <span class="text-text-secondary text-sm ml-auto" id="family-team-count">(0)</span>
                                    </label>
                                    
                                    <!-- Holiday Categories -->
                                    <label class="flex items-center space-x-3 cursor-pointer">
                                        <input type="checkbox" class="w-4 h-4 text-accent bg-surface border-surface-light rounded focus:ring-accent" />
                                        <span class="text-text-primary">Mother's Day</span>
                                        <span class="text-text-secondary text-sm ml-auto" id="mothers-day-count">(0)</span>
                                    </label>
                                                                          <label class="flex items-center space-x-3 cursor-pointer">
                                        <input type="checkbox" class="w-4 h-4 text-accent bg-surface border-surface-light rounded focus:ring-accent" />
                                        <span class="text-text-primary">Father's Day</span>
                                        <span class="text-text-secondary text-sm ml-auto" id="fathers-day-count">(0)</span>
                                      </label>
                                    <label class="flex items-center space-x-3 cursor-pointer">
                                        <input type="checkbox" class="w-4 h-4 text-accent bg-surface border-surface-light rounded focus:ring-accent" />
                                        <span class="text-text-primary">Halloween</span>
                                        <span class="text-text-secondary text-sm ml-auto" id="halloween-count">(0)</span>
                                    </label>
                                    <label class="flex items-center space-x-3 cursor-pointer">
                                        <input type="checkbox" class="w-4 h-4 text-accent bg-surface border-surface-light rounded focus:ring-accent" />
                                        <span class="text-text-primary">Christmas</span>
                                        <span class="text-text-secondary text-sm ml-auto" id="christmas-count">(0)</span>
                                    </label>
                                    <label class="flex items-center space-x-3 cursor-pointer">
                                        <input type="checkbox" class="w-4 h-4 text-accent bg-surface border-surface-light rounded focus:ring-accent" />
                                        <span class="text-text-primary">Other Holidays</span>
                                        <span class="text-text-secondary text-sm ml-auto" id="other-holidays-count">(0)</span>
                                    </label>
                                </div>
                            </div>



                            <!-- Size Options -->
                            <div>
                                <h3 class="font-orbitron text-lg font-bold text-white mb-4">Size</h3>
                                <select id="size-filter" class="w-full px-3 py-2 bg-surface border border-surface-light rounded-lg text-text-primary focus:border-accent focus:outline-none text-sm">
                                    <option value="">All Sizes</option>
                                    <option value="S">S</option>
                                    <option value="M">M</option>
                                    <option value="L">L</option>
                                    <option value="XL">XL</option>
                                    <option value="2X">2X/XXL</option>
                                </select>
                            </div>

                            <!-- Color Options -->
                            <div>
                                <h3 class="font-orbitron text-lg font-bold text-white mb-4">Colors</h3>
                                <select id="color-filter" class="w-full px-3 py-2 bg-surface border border-surface-light rounded-lg text-text-primary focus:border-accent focus:outline-none text-sm">
                                    <option value="">All Colors</option>
                                    <option value="Black">Black</option>
                                    <option value="Navy">Navy</option>
                                    <option value="Athletic Grey Solid">Athletic Grey Solid</option>
                                    <option value="Storm Blue">Storm Blue</option>
                                    <option value="Royal Blue">Royal Blue</option>
                                    <option value="Aqua Blue">Aqua Blue</option>
                                    <option value="Teal Blue Green">Teal Blue Green</option>
                                    <option value="Mint Green">Mint Green</option>
                                    <option value="Evergreen">Evergreen</option>
                                    <option value="Military Green">Military Green</option>
                                    <option value="Army">Army</option>
                                    <option value="Natural">Natural</option>
                                    <option value="Sunset">Sunset</option>
                                    <option value="Orange">Orange</option>
                                    <option value="Autumn">Autumn</option>
                                    <option value="Gold">Gold</option>
                                    <option value="Mustard">Mustard</option>
                                    <option value="White">White</option>
                                    <option value="Charity Pink">Charity Pink</option>
                                    <option value="Fushsia">Fushsia</option>
                                    <option value="Maroon">Maroon</option>
                                    <option value="Red">Red</option>
                                    <option value="Lilac">Lilac</option>
                                    <option value="Team Purple">Team Purple</option>
                                </select>
                            </div>

                            <!-- Clear Filters -->
                            <button id="clear-filters-btn" class="w-full border border-accent text-accent py-2 px-4 rounded-lg hover:bg-accent hover:text-black transition-all duration-300">
                                Clear All Filters
                            </button>
                        </div>
                    </aside>

                    <!-- Product Grid -->
                    <div class="flex-1">
                        <!-- Sort & Results Header -->
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8 gap-4">
                            <div class="text-text-secondary" id="results-display">
                                Showing <span class="text-accent font-semibold">0-0</span> of <span class="text-accent font-semibold">0</span> results
                            </div>
                            
                            <div class="flex items-center space-x-4">
                                <label class="text-text-secondary text-sm">Sort by:</label>
                                <select class="input-field text-sm">
                                    <option>Trending Now</option>
                                    <option>Newest Designs</option>
                                    <option>Customer Favorites</option>
                                    <option>Price: Low to High</option>
                                    <option>Price: High to Low</option>
                                    <option>Best Sellers</option>
                                </select>
                            </div>
                        </div>

                        <!-- Products Grid -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8" id="products-grid">
                            <!-- Loading skeleton -->
                            <div id="loading-skeleton" class="contents">
                                <div class="skeleton-card">
                                    <div class="skeleton skeleton-image mb-4"></div>
                                    <div class="skeleton skeleton-text w-3/4"></div>
                                    <div class="skeleton skeleton-text w-1/2"></div>
                                    <div class="skeleton skeleton-text w-2/3"></div>
                                </div>
                                <div class="skeleton-card">
                                    <div class="skeleton skeleton-image mb-4"></div>
                                    <div class="skeleton skeleton-text w-3/4"></div>
                                    <div class="skeleton skeleton-text w-1/2"></div>
                                    <div class="skeleton skeleton-text w-2/3"></div>
                                </div>
                                <div class="skeleton-card">
                                    <div class="skeleton skeleton-image mb-4"></div>
                                    <div class="skeleton skeleton-text w-3/4"></div>
                                    <div class="skeleton skeleton-text w-1/2"></div>
                                    <div class="skeleton skeleton-text w-2/3"></div>
                                </div>
                                <div class="skeleton-card">
                                    <div class="skeleton skeleton-image mb-4"></div>
                                    <div class="skeleton skeleton-text w-3/4"></div>
                                    <div class="skeleton skeleton-text w-1/2"></div>
                                    <div class="skeleton skeleton-text w-2/3"></div>
                                </div>
                                <div class="skeleton-card">
                                    <div class="skeleton skeleton-image mb-4"></div>
                                    <div class="skeleton skeleton-text w-3/4"></div>
                                    <div class="skeleton skeleton-text w-1/2"></div>
                                    <div class="skeleton skeleton-text w-2/3"></div>
                                </div>
                                <div class="skeleton-card">
                                    <div class="skeleton skeleton-image mb-4"></div>
                                    <div class="skeleton skeleton-text w-3/4"></div>
                                    <div class="skeleton skeleton-text w-1/2"></div>
                                    <div class="skeleton skeleton-text w-2/3"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Load More Button -->
                        <div class="text-center mt-12">
                            <button class="btn-primary px-8 py-3" id="load-more-btn">
                                Load More Designs
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Smart Recommendations -->
        <section class="py-16 border-t border-surface-light">
            <div class="container mx-auto px-6">
                <h2 class="font-orbitron text-3xl font-bold text-white mb-8 text-center">You Might Also Like</h2>
                <div id="recommendations-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Loading state -->
                    <div class="glass-card rounded-xl overflow-hidden flex items-center justify-center h-40">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-accent"></div>
                        </div>
                    <div class="glass-card rounded-xl overflow-hidden flex items-center justify-center h-40">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-accent"></div>
                    </div>
                    <div class="glass-card rounded-xl overflow-hidden flex items-center justify-center h-40">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-accent"></div>
                        </div>
                    <div class="glass-card rounded-xl overflow-hidden flex items-center justify-center h-40">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-accent"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Newsletter Signup -->
        <section class="py-20 relative z-10">
            <div class="container mx-auto px-6">
                <div class="glass-card rounded-2xl p-12 text-center max-w-4xl mx-auto">
                    <h2 class="font-orbitron text-3xl font-bold text-white mb-4">Join the Creative Rebellion</h2>
                    <p class="text-text-secondary text-lg mb-8 max-w-2xl mx-auto">
                        Be the first to know about new designs, exclusive drops, and behind-the-scenes content from Lori's creative journey.
                    </p>
                    
                    <form id="newsletterForm" class="flex flex-col sm:flex-row gap-4 max-w-lg mx-auto">
                        <input type="email" id="newsletterEmail" placeholder="Enter your email" class="input-field flex-1" required />
                        <button type="submit" id="subscribeBtn" class="btn-primary neon-glow whitespace-nowrap">
                            <span class="btn-text">Subscribe Now</span>
                            <span class="btn-loading hidden">Subscribing...</span>
                        </button>
                    </form>
                    <div id="newsletterMessage" class="mt-4 hidden"></div>
                    
                    <p class="text-text-secondary text-sm mt-4">
                        No spam, just creative inspiration. Unsubscribe anytime.
                    </p>
                </div>
            </div>
        </section>
    </main>

    <!-- Recently Viewed Bar -->
    <div class="recently-viewed" id="recently-viewed">
        <div class="container mx-auto px-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-orbitron text-lg font-bold text-white">Recently Viewed</h3>
                <button class="text-text-secondary hover:text-accent" id="close-recently-viewed">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="flex justify-center space-x-6 overflow-x-auto py-2" id="recently-viewed-products">
                <!-- Loading state -->
                <div class="flex-shrink-0 w-24 flex flex-col items-center justify-center">
                    <div class="w-20 h-20 bg-surface-light rounded-lg flex items-center justify-center mb-2">
                        <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-accent"></div>
                </div>
                    <div class="w-16 h-4 bg-surface-light rounded animate-pulse"></div>
                    <div class="w-12 h-3 bg-surface-light rounded animate-pulse mt-1"></div>
                </div>
                <div class="flex-shrink-0 w-24 flex flex-col items-center justify-center">
                    <div class="w-20 h-20 bg-surface-light rounded-lg flex items-center justify-center mb-2">
                        <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-accent"></div>
                </div>
                    <div class="w-16 h-4 bg-surface-light rounded animate-pulse"></div>
                    <div class="w-12 h-3 bg-surface-light rounded animate-pulse mt-1"></div>
            </div>
                <div class="flex-shrink-0 w-24 flex flex-col items-center justify-center">
                    <div class="w-20 h-20 bg-surface-light rounded-lg flex items-center justify-center mb-2">
                        <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-accent"></div>
                    </div>
                    <div class="w-16 h-4 bg-surface-light rounded animate-pulse"></div>
                    <div class="w-12 h-3 bg-surface-light rounded animate-pulse mt-1"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-surface-dark border-t border-surface-light py-16 relative z-10">
        <div class="container mx-auto px-6">
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">
                <!-- Brand -->
                <div class="space-y-4">
                    <div class="flex items-center space-x-3">
                        <svg class="w-8 h-8 text-accent" viewBox="0 0 40 40" fill="currentColor">
                            <path d="M20 2L37 12v16L20 38L3 28V12L20 2z"/>
                            <circle cx="20" cy="20" r="8" fill="#0a0a0a"/>
                            <text x="20" y="25" text-anchor="middle" class="text-xs font-bold fill-accent">P</text>
                        </svg>
                        <span class="font-orbitron text-lg font-bold text-gradient">PlwgsCreativeApparel</span>
                    </div>
                    <p class="text-text-secondary text-sm">
                        Creative rebellion through wearable art. Transforming everyday apparel into conversation starters since 2023.
                    </p>
                </div>

                <!-- Quick Links -->
                <div>
                    <h3 class="font-orbitron text-white font-bold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="shop.html" class="text-text-secondary hover:text-accent transition-colors">Shop All</a></li>
                        <li><a href="custom.html" class="text-text-secondary hover:text-accent transition-colors">Custom Orders</a></li>
                        <li><a href="javascript:void(0)" class="text-text-secondary hover:text-accent transition-colors">Size Guide</a></li>
                        <li><a href="javascript:void(0)" class="text-text-secondary hover:text-accent transition-colors">Care Instructions</a></li>
                    </ul>
                </div>

                <!-- Customer Care -->
                <div>
                    <h3 class="font-orbitron text-white font-bold mb-4">Customer Care</h3>
                    <ul class="space-y-2">
                        <li><a href="account.html" class="text-text-secondary hover:text-accent transition-colors">My Account</a></li>
                        <li><a href="javascript:void(0)" class="text-text-secondary hover:text-accent transition-colors">Order Tracking</a></li>
                        <li><a href="javascript:void(0)" class="text-text-secondary hover:text-accent transition-colors">Returns & Exchanges</a></li>
                        <li><a href="javascript:void(0)" class="text-text-secondary hover:text-accent transition-colors">Contact Support</a></li>
                    </ul>
                </div>

                <!-- Connect -->
                <div>
                    <h3 class="font-orbitron text-white font-bold mb-4">Connect</h3>
                    <div class="flex space-x-4 mb-4">
                        <a href="javascript:void(0)" class="text-text-secondary hover:text-accent transition-colors">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
                            </svg>
                        </a>
                        <a href="javascript:void(0)" class="text-text-secondary hover:text-accent transition-colors">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.174-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.402.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.357-.629-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24.009 12.017 24.009c6.624 0 11.99-5.367 11.99-11.988C24.007 5.367 18.641.001.012.001z"/>
                            </svg>
                        </a>
                        <a href="javascript:void(0)" class="text-text-secondary hover:text-accent transition-colors">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                            </svg>
                        </a>
                    </div>
                    <p class="text-text-secondary text-sm">
                        Follow us for daily inspiration and behind-the-scenes content.
                    </p>
                </div>
            </div>

            <div class="border-t border-surface-light pt-8 flex flex-col md:flex-row justify-between items-center">
                <p class="text-text-secondary text-sm">
                    © 2025 PlwgsCreativeApparel. All Rights Reserved.
                </p>
                <div class="flex space-x-6 mt-4 md:mt-0">
                                            <a href="privacy-policy.html" class="text-text-secondary hover:text-accent transition-colors text-sm">Privacy Policy</a>
                        <a href="terms-of-service.html" class="text-text-secondary hover:text-accent transition-colors text-sm">Terms of Service</a>
                    <a href="javascript:void(0)" class="text-text-secondary hover:text-accent transition-colors text-sm">Shipping Info</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Frontend Enhancements -->
    <script src="../public/frontend-enhancements.js"></script>

    <!-- JavaScript -->
    <script>
        // Particle Animation
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Mobile Menu Toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuClose = document.getElementById('mobile-menu-close');

        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.remove('-translate-x-full');
        });

        mobileMenuClose.addEventListener('click', () => {
            mobileMenu.classList.add('-translate-x-full');
        });

        // Search Dropdown
        const searchInput = document.getElementById('search-input');
        const searchDropdown = document.getElementById('search-dropdown');

        searchInput.addEventListener('focus', () => {
            searchDropdown.classList.remove('hidden');
        });

        searchInput.addEventListener('blur', () => {
            setTimeout(() => {
                searchDropdown.classList.add('hidden');
            }, 200);
        });

        // Filter Chips (Mobile)
        const filterChips = document.querySelectorAll('.filter-chip');
        filterChips.forEach(chip => {
            chip.addEventListener('click', () => {
                const filterType = chip.dataset.filter;
                const category = chip.dataset.category;
                
                if (filterType === 'size') {
                    // Show size filter modal or dropdown for mobile
                    showMobileSizeFilter();
                } else if (filterType === 'color') {
                    // Show color filter modal or dropdown for mobile
                    showMobileColorFilter();
                } else if (category) {
                    // Handle category filtering (existing functionality)
                // Remove active class from all chips
                filterChips.forEach(c => c.classList.remove('active'));
                // Add active class to clicked chip
                chip.classList.add('active');
                }
            });
        });
        
        // Mobile filter functions
        function showMobileSizeFilter() {
            // Create a simple mobile-friendly size filter
            const sizeOptions = ['All Sizes', 'S', 'M', 'L', 'XL', '2X/XXL'];
            const selectedSize = prompt('Select a size:\n' + sizeOptions.map((size, index) => `${index}: ${size}`).join('\n'));
            
            if (selectedSize !== null && !isNaN(selectedSize) && selectedSize >= 0 && selectedSize < sizeOptions.length) {
                const sizeFilter = document.getElementById('size-filter');
                if (sizeFilter) {
                    sizeFilter.value = selectedSize === '0' ? '' : sizeOptions[selectedSize];
                    // Trigger the change event
                    sizeFilter.dispatchEvent(new Event('change'));
                }
            }
        }
        
        function showMobileColorFilter() {
            // Create a simple mobile-friendly color filter
            const colorOptions = [
                'All Colors', 'Black', 'White', 'Natural', 'Ice Grey', 'Brown', 'Navy', 
                'Aqua', 'Royal Blue', 'Teal', 'Gold', 'Army', 'Army Green', 'Military Green', 
                'Evergreen', 'Olive Green', 'Kelly Green', 'Mint', 'Sunset', 'Orange', 
                'Autumn', 'Mustard', 'Purple', 'Lilac', 'Charity Pink', 'Fushsia', 
                'Soft Pink', 'Pink', 'Berry', 'Red', 'Maroon', 'Gray', 'Green'
            ];
            
            const selectedColor = prompt('Select a color:\n' + colorOptions.map((color, index) => `${index}: ${color}`).join('\n'));
            
            if (selectedColor !== null && !isNaN(selectedColor) && selectedColor >= 0 && selectedColor < colorOptions.length) {
                const colorFilter = document.getElementById('color-filter');
                if (colorFilter) {
                    colorFilter.value = selectedColor === '0' ? '' : colorOptions[selectedColor];
                    // Trigger the change event
                    colorFilter.dispatchEvent(new Event('change'));
                }
            }
        }

        // Recently Viewed Bar
        const recentlyViewed = document.getElementById('recently-viewed');
        const closeRecentlyViewed = document.getElementById('close-recently-viewed');

        // Show recently viewed bar after 3 seconds
        setTimeout(() => {
            recentlyViewed.classList.add('show');
        }, 3000);

        closeRecentlyViewed.addEventListener('click', () => {
            recentlyViewed.classList.remove('show');
        });

        // Load More Products - Pagination System
        const loadMoreBtn = document.getElementById('load-more-btn');
        const productsGrid = document.getElementById('products-grid');

        // Global variables for pagination and filtering
        let currentPage = 0;
        let totalPages = 1;
        let allProducts = [];
        let filteredProducts = []; // Store filtered products for pagination
        const productsPerPage = 6;

        // Load products from database
        async function loadProductsFromDatabase() {
            console.log('🔄 Loading products from database...');
            try {
                const response = await fetch('/api/products/public');
                console.log('📡 API Response status:', response.status);
                if (response.ok) {
                    const products = await response.json();
                    console.log('📦 Loaded products:', products);
                    console.log('📦 Raw products data:', JSON.stringify(products, null, 2));
                    
                    // Check each product's image URL
                    products.forEach((product, index) => {
                        console.log(`📸 Product ${index + 1}: ${product.name}`);
                        console.log(`   Image URL: ${product.image_url}`);
                        console.log(`   Has Cloudinary URL: ${product.image_url && product.image_url.startsWith('https://res.cloudinary.com')}`);
                    });
                    
                    allProducts = Array.isArray(products) ? products : [];
                    window.filteredProducts = []; // Initialize filteredProducts as empty on initial load
                    console.log('📦 Processed products array:', allProducts);
                    
                    // Debug: Check what categories are actually in the database
                    const categoriesInDB = {};
                    allProducts.forEach(product => {
                        const category = product.category || 'No Category';
                        categoriesInDB[category] = (categoriesInDB[category] || 0) + 1;
                    });
                    console.log('🔍 Categories found in database:', categoriesInDB);
                    
                    totalPages = Math.ceil(allProducts.length / productsPerPage);
                    console.log('📄 Total pages:', totalPages);
                    displayProducts(0, allProducts); // Pass allProducts explicitly
                    updateProductCounts();
                } else {
                    console.log('❌ No products found in database');
                    allProducts = [];
                    window.filteredProducts = [];
                    totalPages = 0;
                    displayProducts(0, []); // Pass empty array explicitly
                    updateProductCounts();
                }
            } catch (error) {
                console.error('❌ Error loading products:', error);
                allProducts = [];
                window.filteredProducts = [];
                totalPages = 0;
                displayProducts(0, []); // Pass empty array explicitly
                updateProductCounts();
            }
        }

        // Function to create product cards
        function createProductCard(product) {
            console.log('🎯 Creating product card for:', product.name);
            console.log('📸 Product image_url:', product.image_url);
            
            const productCard = document.createElement('div');
            productCard.className = 'product-card glass-card rounded-2xl overflow-hidden group';
            
            // Use database product fields
            const productImage = product.image_url || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjM0I0QjVCIi8+CjxwYXRoIGQ9Ik0yNSAyNUg3NVY3NUgyNVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+CjxwYXRoIGQ9Ik0zNSA0NUw2NSA0NU02NSA2NUwzNSA2NUwzNSA0NVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo=';
            const productTitle = product.name || 'Product';
            const productCategory = product.category || 'Custom Design';
            
            // Get size pricing from product data
            const sizePricing = product.size_pricing || {};
            const defaultSize = 'M';
            const defaultPrice = sizePricing[defaultSize]?.price || parseFloat(product.price) || 20.00;
            const productPrice = `$${defaultPrice.toFixed(2)}`;
            
            console.log('🖼️ Final image URL being used:', productImage);
            console.log('💰 Size pricing data:', sizePricing);
            
            productCard.innerHTML = `
                <div class="relative">
                    <img src="${productImage}" alt="${productTitle}" class="w-full h-64 object-cover" loading="lazy" onerror="console.error('❌ Image failed to load:', this.src); this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjM0I0QjVCIi8+CjxwYXRoIGQ9Ik0yNSAyNUg3NVY3NUgyNVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+CjxwYXRoIGQ9Ik0zNSA0NUw2NSA0NU02NSA2NUwzNSA2NUwzNSA0NVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo='; this.onerror=null;" onload="console.log('✅ Image loaded successfully:', this.src);">
                    <div class="product-overlay"></div>
                    <div class="product-info">
                        <button class="btn-primary w-full text-sm view-details-btn" data-product="${encodeURIComponent(JSON.stringify(product))}">View Details</button>
                        <button class="btn-secondary w-full text-sm mt-2 add-to-cart-btn" data-product="${encodeURIComponent(JSON.stringify(product))}">Add to Cart</button>
                    </div>
                </div>
                <div class="p-6">
                    <h3 class="font-orbitron text-lg font-bold text-white mb-2">${productTitle}</h3>
                    <p class="text-text-secondary text-sm mb-3">${productCategory}</p>
                    
                    <!-- Size Selection -->
                    <div class="mb-3">
                        <label class="block text-text-secondary text-sm mb-2">Size:</label>
                        <select class="size-selector w-full px-3 py-2 bg-surface border border-surface-light rounded-lg text-text-primary focus:border-accent focus:outline-none text-sm" data-product-id="${product.id}">
                            <option value="S" data-price="${sizePricing.S?.price || parseFloat(product.price) || 20.00}">S - $${(sizePricing.S?.price || parseFloat(product.price) || 20.00).toFixed(2)}</option>
                            <option value="M" data-price="${sizePricing.M?.price || parseFloat(product.price) || 20.00}" selected>M - $${(sizePricing.M?.price || parseFloat(product.price) || 20.00).toFixed(2)}</option>
                            <option value="L" data-price="${sizePricing.L?.price || parseFloat(product.price) || 20.00}">L - $${(sizePricing.L?.price || parseFloat(product.price) || 20.00).toFixed(2)}</option>
                            <option value="XL" data-price="${sizePricing.XL?.price || parseFloat(product.price) || 20.00}">XL - $${(sizePricing.XL?.price || parseFloat(product.price) || 20.00).toFixed(2)}</option>
                            <option value="2X" data-price="${sizePricing['2X']?.price || (parseFloat(product.price) || 20.00) + 4.00}">2X - $${(sizePricing['2X']?.price || (parseFloat(product.price) || 20.00) + 4.00).toFixed(2)}</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <span class="text-accent font-bold text-xl product-price-display">${productPrice}</span>
                        <div class="flex items-center space-x-1">
                            <svg class="w-4 h-4 text-warning fill-current" viewBox="0 0 20 20">
                                <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                            </svg>
                            <span class="text-text-secondary text-sm">4.8 (145)</span>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listener for View Details button
            const viewDetailsBtn = productCard.querySelector('.view-details-btn');
            viewDetailsBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent card click
                
                try {
                    const productData = JSON.parse(decodeURIComponent(viewDetailsBtn.dataset.product));
                    
                    // Debug logging
                    console.log('=== SHOP PAGE DEBUG ===');
                    console.log('Product data for details page:', productData);
                    console.log('Product name:', productData.name);
                    console.log('Product price:', productData.price);
                    console.log('Product image:', productData.image_url);
                    
                    // Redirect to product detail page with product ID
                    const productId = productData.id || encodeURIComponent(productData.name);
                    window.location.href = `product.html?id=${productId}`;
                } catch (error) {
                    console.error('Error processing product data:', error);
                    console.error('Product data string:', viewDetailsBtn.dataset.product);
                    alert('Error loading product details. Please try again.');
                }
            });
            
            // Add event listener for Add to Cart button
            const addToCartBtn = productCard.querySelector('.add-to-cart-btn');
            if (addToCartBtn) {
                addToCartBtn.addEventListener('click', async (e) => {
                    e.stopPropagation(); // Prevent card click
                    
                    try {
                        const productData = JSON.parse(decodeURIComponent(addToCartBtn.dataset.product));
                        const sizeSelector = productCard.querySelector('.size-selector');
                        const selectedSize = sizeSelector ? sizeSelector.value : 'M';
                        
                        console.log('🛒 Adding to cart:', productData.name, 'Size:', selectedSize);
                        await addToCartAPI(productData, selectedSize);
                    } catch (error) {
                        console.error('Error adding to cart:', error);
                        alert('Error adding product to cart. Please try again.');
                    }
                });
            }
            
            // Add event listener for size selector to update price
            const sizeSelector = productCard.querySelector('.size-selector');
            if (sizeSelector) {
                sizeSelector.addEventListener('change', function() {
                    const selectedOption = this.options[this.selectedIndex];
                    const newPrice = parseFloat(selectedOption.dataset.price);
                    const priceDisplay = productCard.querySelector('.product-price-display');
                    
                    if (priceDisplay && !isNaN(newPrice)) {
                        priceDisplay.textContent = `$${newPrice.toFixed(2)}`;
                        console.log(`💰 Price updated to $${newPrice.toFixed(2)} for size ${this.value}`);
                    }
                });
            }
            
            return productCard;
        }

        // Function to handle size changes and price updates
        function updateProductPrice(productCard, selectedSize) {
            const sizeSelector = productCard.querySelector('.size-selector');
            if (!sizeSelector) return;
            
            const selectedOption = sizeSelector.querySelector(`option[value="${selectedSize}"]`);
            if (selectedOption) {
                const newPrice = parseFloat(selectedOption.dataset.price);
                const priceDisplay = productCard.querySelector('.product-price-display');
                
                if (priceDisplay && !isNaN(newPrice)) {
                    priceDisplay.textContent = `$${newPrice.toFixed(2)}`;
                    console.log(`💰 Price updated to $${newPrice.toFixed(2)} for size ${selectedSize}`);
                }
            }
        }

        // Function to add item to cart via API
        async function addToCartAPI(productData, selectedSize = 'M') {
            try {
                const token = localStorage.getItem('customerToken');
                if (!token) {
                    // Show a better notification instead of alert
                    showNotification('Please log in to add items to cart', 'error');
                    
                    // Wait a moment then redirect
                    setTimeout(() => {
                        if (confirm('You need to log in to add items to cart. Would you like to go to the login page?')) {
                    window.location.href = 'customer-login.html';
                        }
                    }, 1500);
                    return;
                }

                // Get the price for the selected size
                let unitPrice = productData.price || 0;
                if (productData.size_pricing && productData.size_pricing[selectedSize]) {
                    unitPrice = productData.size_pricing[selectedSize].price;
                }

                const cartData = {
                    product_name: productData.name,
                    quantity: 1,
                    unit_price: unitPrice,
                    size: selectedSize,
                    color: 'Black', // Default color
                    image_url: productData.image_url
                };

                console.log('Sending cart data to API:', cartData);

                const response = await fetch('/api/cart/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(cartData)
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('Cart API response:', result);
                    
                    // Show success message
                    showNotification('Added to cart!', 'success');
                    
                    // Update cart counter
                    updateCartCounter();
                    
                    // Optionally redirect to cart page
                    setTimeout(() => {
                        if (confirm('Item added to cart! Would you like to view your cart?')) {
                            window.location.href = 'cart.html';
                        }
                    }, 1000);
                } else {
                    let errorMessage = 'Unknown error occurred';
                    
                    // Handle specific error cases
                    if (response.status === 401) {
                        errorMessage = 'Please log in to add items to cart';
                        showNotification(errorMessage, 'error');
                        setTimeout(() => {
                            if (confirm('You need to log in to add items to cart. Would you like to go to the login page?')) {
                                window.location.href = 'customer-login.html';
                            }
                        }, 1500);
                    } else if (response.status === 403) {
                        errorMessage = 'Your session has expired. Please log in again.';
                        showNotification(errorMessage, 'error');
                        localStorage.removeItem('customerToken'); // Clear expired token
                        setTimeout(() => {
                            if (confirm('Your session has expired. Would you like to log in again?')) {
                                window.location.href = 'customer-login.html';
                            }
                        }, 1500);
                    } else {
                        // Try to get error message from response, but don't consume the body twice
                        try {
                    const errorData = await response.json();
                            errorMessage = errorData.error || errorMessage;
                        } catch (parseError) {
                            console.log('Could not parse error response, using default message');
                        }
                        showNotification('Error adding to cart: ' + errorMessage, 'error');
                    }
                }
            } catch (error) {
                console.error('Error adding to cart:', error);
                showNotification('Network error. Please check your connection and try again.', 'error');
            }
        }

        // Function to show notifications
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${
                type === 'success' ? 'bg-green-500 text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-blue-500 text-white'
            }`;
            notification.textContent = message;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Function to update product counts and display
        function updateProductCounts(filteredProductsCount = null) {
            const totalProducts = filteredProductsCount !== null ? filteredProductsCount : allProducts.length;
            const startIndex = currentPage * productsPerPage + 1;
            const endIndex = Math.min((currentPage + 1) * productsPerPage, totalProducts);
            
            console.log('📊 Updating product counts:');
            console.log('📦 Total products:', totalProducts);
            console.log('📄 Current page:', currentPage);
            console.log('📋 Showing range:', startIndex, 'to', endIndex);
            
            // Update the results display
            const resultsDisplay = document.getElementById('results-display');
            if (resultsDisplay) {
                resultsDisplay.innerHTML = `Showing <span class="text-accent font-semibold">${startIndex}-${endIndex}</span> of <span class="text-accent font-semibold">${totalProducts}</span> results`;
                console.log('✅ Updated results display');
            } else {
                console.log('❌ Results display element not found');
            }
            
            // Update category counts
            const allDesignsCount = document.getElementById('all-designs-count');
            if (allDesignsCount) {
                allDesignsCount.textContent = `(${totalProducts})`;
                console.log('✅ Updated all designs count');
            } else {
                console.log('❌ All designs count element not found');
            }
            
            // Update category counts based on actual product data
            updateCategoryCounts();
            
            console.log('✅ Updated all category counts');
        }

        function displayProducts(page = 0, productsToDisplay = null) {
            const products = productsToDisplay || allProducts;
            console.log('🎨 Displaying products for page:', page);
            console.log('📦 Total products:', products.length);
            console.log('📄 Products per page:', productsPerPage);
            
            // Check if productsGrid exists
            if (!productsGrid) {
                console.error('❌ productsGrid element not found!');
                return;
            }
            
            // Clear current products
            productsGrid.innerHTML = '';
            
            // Calculate start and end indices for current page
            const startIndex = page * productsPerPage;
            const endIndex = Math.min(startIndex + productsPerPage, products.length);
            console.log('📋 Showing products from index', startIndex, 'to', endIndex);
            
            // Add products for current page
            for (let i = startIndex; i < endIndex; i++) {
                const product = products[i];
                console.log('🎯 Creating card for product:', product.name);
                const productCard = createProductCard(product);
                productsGrid.appendChild(productCard);
            }
            
            // Update button text
            if (loadMoreBtn) {
                loadMoreBtn.textContent = `Load More Designs (${page + 1}/${totalPages})`;
                
                // Hide button if we're on the last page
                if (page >= totalPages - 1) {
                    loadMoreBtn.style.display = 'none';
                } else {
                    loadMoreBtn.style.display = 'block';
                }
            } else {
                console.log('⚠️ loadMoreBtn element not found');
            }
            
            // Update product counts display
            updateProductCounts(products.length);
        }

        // Function to load more products with proper filtering logic
        function loadMoreProducts() {
            // Determine which product list to use
            const productsToUse = window.filteredProducts && window.filteredProducts.length > 0 ? window.filteredProducts : window.allProducts;
            
            currentPage++; // Increment page for the list being used
            displayProducts(currentPage, productsToUse); // Display the relevant list
        }

        // Function to reset filters and return to showing all products
        function resetFilters() {
            // Clear active filter buttons visually
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-pressed', 'false');
            });

            // Clear the global filteredProducts array
            window.filteredProducts = [];

            // Reset to first page
            currentPage = 0;

            // Clear search
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.value = '';
            }

            // Re-display all products from the first page
            displayProducts(0, window.allProducts);

            // Update counts based on all products
            if (window.allProducts) {
                updateProductCounts(window.allProducts.length);
            }
            console.log('Filters reset, displaying all products.');
        }



        // Initialize with first page - moved to after categories and products are loaded

        if (loadMoreBtn) {
            loadMoreBtn.addEventListener('click', () => {
                // Show loading state
                loadMoreBtn.textContent = 'Loading...';
                loadMoreBtn.disabled = true;

                // Simulate loading delay
                setTimeout(() => {
                    loadMoreProducts(); // Use the new function
                    loadMoreBtn.disabled = false;
                }, 800);
            });
        } else {
            console.log('⚠️ loadMoreBtn not found, skipping event listener');
        }

        // Mouse movement particle effect
        document.addEventListener('mousemove', (e) => {
            const particles = document.querySelectorAll('.particle');
            const mouseX = e.clientX / window.innerWidth;
            const mouseY = e.clientY / window.innerHeight;

            particles.forEach((particle, index) => {
                const speed = (index % 3 + 1) * 0.5;
                const x = (mouseX - 0.5) * speed * 20;
                const y = (mouseY - 0.5) * speed * 20;
                
                particle.style.transform = `translate(${x}px, ${y}px)`;
            });
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Initialize particles on load
        document.addEventListener('DOMContentLoaded', createParticles);

        // Navbar scroll effect
        window.addEventListener('scroll', () => {
            const navbar = document.querySelector('header');
            if (window.scrollY > 100) {
                navbar.classList.add('backdrop-blur-lg');
            } else {
                navbar.classList.remove('backdrop-blur-lg');
            }
        });

        // Category filtering functionality
        let selectedCategories = ['All Designs'];
        let allCategories = [];
        
        // Load categories dynamically from database
        async function loadCategories() {
            try {
                console.log('🔄 Loading categories from API...');
                const response = await fetch('/api/admin/categories');
                console.log('📡 Categories API response status:', response.status);
                if (response.ok) {
                    allCategories = await response.json();
                    console.log('📋 Categories loaded:', allCategories.length, 'categories');
                    console.log('📋 Categories data:', allCategories);
                    updateCategoryFilterSidebar();
                    updateCategoryCounts();
                } else {
                    console.error('❌ Failed to load categories, status:', response.status);
                }
            } catch (error) {
                console.error('❌ Error loading categories:', error);
            }
        }
        
        // Update category filter sidebar dynamically
        function updateCategoryFilterSidebar() {
            console.log('🔄 Updating category filter sidebar...');
            console.log('📋 Current allCategories:', allCategories);
            
            // Update main category filter section
            const categorySection = document.querySelector('.filter-sidebar .space-y-8 > div:first-child');
            if (categorySection) {
                let filterHTML = '<h3 class="font-orbitron text-lg font-bold text-white mb-4">Categories</h3>';
                filterHTML += '<div class="space-y-3">';
                
                // Add "All Designs" option
                filterHTML += `
                    <label class="flex items-center space-x-3 cursor-pointer">
                        <input type="checkbox" class="w-4 h-4 text-accent bg-surface border-surface-light rounded focus:ring-accent category-checkbox" checked data-category="All Designs" />
                        <span class="text-text-primary">All Designs</span>
                        <span class="text-text-secondary text-sm ml-auto" id="all-designs-count">(0)</span>
                    </label>
                `;
                
                // Add dynamic categories - only if categories are loaded
                if (allCategories && allCategories.length > 0) {
                    allCategories.forEach(category => {
                        if (category.name !== 'Uncategorized') {
                            const categoryId = category.name.toLowerCase().replace(/[^a-z0-9]/g, '-');
                            filterHTML += `
                                <label class="flex items-center space-x-3 cursor-pointer">
                                    <input type="checkbox" class="w-4 h-4 text-accent bg-surface border-surface-light rounded focus:ring-accent category-checkbox" data-category="${category.name}" />
                                    <span class="text-text-primary">${category.name}</span>
                                    <span class="text-text-secondary text-sm ml-auto" id="${categoryId}-count">(0)</span>
                                </label>
                            `;
                        }
                    });
                }
                
                filterHTML += '</div>';
                console.log('📝 Generated filter HTML:', filterHTML);
                categorySection.innerHTML = filterHTML;
                console.log('✅ Category filter sidebar updated');
            }
            
            // Update mobile filter chips
            const mobileChipsSection = document.querySelector('.mobile-filter-chips');
            if (mobileChipsSection) {
                let chipsHTML = '';
                chipsHTML += '<button class="filter-chip active" data-category="all">All Designs</button>';
                
                if (allCategories && allCategories.length > 0) {
                    allCategories.forEach(category => {
                        if (category.name !== 'Uncategorized') {
                            const categoryId = category.name.toLowerCase().replace(/[^a-z0-9]/g, '-');
                            chipsHTML += `
                                <button class="filter-chip" data-category="${categoryId}">
                                    ${category.name}
                                </button>
                            `;
                        }
                    });
                }
                
                mobileChipsSection.innerHTML = chipsHTML;
            }
            
            // Re-attach event listeners
            setupCategoryEventListeners();
        }
        
        // Setup category event listeners
        function setupCategoryEventListeners() {
            // Remove old listeners
            const oldCheckboxes = document.querySelectorAll('.category-checkbox');
            oldCheckboxes.forEach(checkbox => {
                checkbox.removeEventListener('change', handleCategoryChange);
            });
            
            // Add new listeners
            const newCheckboxes = document.querySelectorAll('.category-checkbox');
            newCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', handleCategoryChange);
            });
        }
        
        // Handle category checkbox changes
        function handleCategoryChange() {
            const selectedCheckboxes = document.querySelectorAll('.category-checkbox:checked');
            selectedCategories = Array.from(selectedCheckboxes).map(checkbox => checkbox.dataset.category);
            
            if (selectedCategories.includes('All Designs')) {
                // If "All Designs" is selected, uncheck others
                document.querySelectorAll('.category-checkbox:not([data-category="All Designs"])').forEach(checkbox => {
                    checkbox.checked = false;
                });
                selectedCategories = ['All Designs'];
            } else {
                // Remove "All Designs" if specific categories are selected
                const allDesignsCheckbox = document.querySelector('.category-checkbox[data-category="All Designs"]');
                if (allDesignsCheckbox) allDesignsCheckbox.checked = false;
            }
            
            console.log('🎯 Selected categories:', selectedCategories);
            filterProductsByCategory();
        }
        
        function updateCategoryCounts() {
            const categoryCounts = {};
            
            // Count products in each category
            allProducts.forEach(product => {
                const category = product.category || 'Adult Shirts'; // Default category
                categoryCounts[category] = (categoryCounts[category] || 0) + 1;
            });
            
            // Update "All Designs" count
            const allDesignsElement = document.getElementById('all-designs-count');
            if (allDesignsElement) {
                allDesignsElement.textContent = `(${allProducts.length})`;
            }
            
            // Update all category count displays - only if categories are loaded
            if (allCategories && allCategories.length > 0) {
                allCategories.forEach(category => {
                    if (category.name !== 'Uncategorized') {
                        const categoryId = category.name.toLowerCase().replace(/[^a-z0-9]/g, '-');
                        const element = document.getElementById(`${categoryId}-count`);
                        if (element) {
                            element.textContent = `(${categoryCounts[category.name] || 0})`;
                        }
                    }
                });
            }
            
            console.log('✅ Category counts updated:', categoryCounts);
        }
        
        async function filterProductsByCategory() {
            // Now use the comprehensive filtering function that handles categories, size, and color
            await applyAllFilters();
        }
        
        // Load categories when page loads, then load products
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('🚀 DOM loaded, starting initialization...');
            try {
                await loadCategories();
                console.log('✅ Categories loaded, now loading products...');
                await loadProductsFromDatabase();
                console.log('✅ Initialization complete!');
                
                // Load recommendations and recently viewed products after products are loaded
                console.log('🎯 Loading recommendations...');
                await loadRecommendations();
                
                console.log('👁️ Loading recently viewed products...');
                await loadRecentlyViewedProducts();
            } catch (error) {
                console.error('❌ Error during initialization:', error);
                // Still try to load products even if categories fail
                await loadProductsFromDatabase();
            }
        });

        // Size filter functionality
        const sizeButtons = document.querySelectorAll('button[class*="border-"]');
        sizeButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Remove active state from all size buttons
                sizeButtons.forEach(btn => {
                    btn.classList.remove('border-accent', 'text-accent', 'bg-accent', 'bg-opacity-10');
                    btn.classList.add('border-surface-light', 'text-text-primary');
                });
                
                // Add active state to clicked button
                button.classList.remove('border-surface-light', 'text-text-primary');
                button.classList.add('border-accent', 'text-accent', 'bg-accent', 'bg-opacity-10');
            });
        });

        // Newsletter Subscription
        const newsletterForm = document.getElementById('newsletterForm');
        const newsletterEmail = document.getElementById('newsletterEmail');
        const subscribeBtn = document.getElementById('subscribeBtn');
        const btnText = subscribeBtn?.querySelector('.btn-text');
        const btnLoading = subscribeBtn?.querySelector('.btn-loading');
        const newsletterMessage = document.getElementById('newsletterMessage');

        if (newsletterForm) {
            newsletterForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const email = newsletterEmail.value.trim();
                
                if (!email) {
                    showMessage('Please enter a valid email address.', 'error');
                    return;
                }

                // Show loading state
                btnText.classList.add('hidden');
                btnLoading.classList.remove('hidden');
                subscribeBtn.disabled = true;

                try {
                    const response = await fetch('/api/subscribe', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        showMessage('🎉 Welcome to the Creative Rebellion! Check your email for your 20% OFF code.', 'success');
                        newsletterEmail.value = '';
                    } else {
                        showMessage(data.error || 'Something went wrong. Please try again.', 'error');
                    }
                } catch (error) {
                    console.error('Newsletter subscription error:', error);
                    showMessage('Network error. Please check your connection and try again.', 'error');
                } finally {
                    // Reset button state
                    btnText.classList.remove('hidden');
                    btnLoading.classList.add('hidden');
                    subscribeBtn.disabled = false;
                }
            });
        }

        function showMessage(message, type) {
            if (!newsletterMessage) return;
            
            newsletterMessage.textContent = message;
            newsletterMessage.className = `mt-4 p-3 rounded-lg text-center ${
                type === 'success' 
                    ? 'bg-green-900/20 border border-green-500/30 text-green-400' 
                    : 'bg-red-900/20 border border-red-500/30 text-red-400'
            }`;
            newsletterMessage.classList.remove('hidden');
            
            // Hide message after 5 seconds
            setTimeout(() => {
                newsletterMessage.classList.add('hidden');
            }, 5000);
        }

        // Cart counter functionality
        async function updateCartCounter() {
            try {
                const token = localStorage.getItem('customerToken');
                if (!token) {
                    document.getElementById('cart-counter').textContent = '0';
                    return;
                }

                const response = await fetch('/api/cart', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const cartData = await response.json();
                    const itemCount = cartData.items ? cartData.items.length : 0;
                    document.getElementById('cart-counter').textContent = itemCount.toString();
                } else {
                    document.getElementById('cart-counter').textContent = '0';
                }
            } catch (error) {
                console.error('Error updating cart counter:', error);
                document.getElementById('cart-counter').textContent = '0';
            }
        }

        // Update cart counter on page load
        updateCartCounter();

        // Check authentication status and update UI
        function checkAuthStatus() {
            const token = localStorage.getItem('customerToken');
            const authStatus = document.getElementById('auth-status');
            const loginLink = document.getElementById('login-link');
            const accountLink = document.getElementById('account-link');
            const logoutBtn = document.getElementById('logout-btn');
            const mobileLoginLink = document.getElementById('mobile-login-link');
            const mobileAccountLink = document.getElementById('mobile-account-link');
            const mobileLogoutBtn = document.getElementById('mobile-logout-btn');
            const loginCta = document.getElementById('login-cta');
            const navLoginLink = document.getElementById('nav-login-link');
            const navAccountLink = document.getElementById('nav-account-link');
            
            if (token) {
                // User is logged in
                if (loginLink) loginLink.classList.add('hidden');
                if (accountLink) accountLink.classList.remove('hidden');
                if (logoutBtn) logoutBtn.classList.remove('hidden');
                if (mobileLoginLink) mobileLoginLink.classList.add('hidden');
                if (mobileAccountLink) mobileAccountLink.classList.remove('hidden');
                if (mobileLogoutBtn) mobileLogoutBtn.classList.remove('hidden');
                if (loginCta) loginCta.classList.add('hidden');
                if (navLoginLink) navLoginLink.classList.add('hidden');
                if (navAccountLink) navAccountLink.classList.remove('hidden');
                
                // Add logout functionality
                if (logoutBtn) {
                    logoutBtn.onclick = () => {
                        localStorage.removeItem('customerToken');
                        checkAuthStatus();
                        updateCartCounter();
                        showNotification('Logged out successfully', 'success');
                    };
                }
                if (mobileLogoutBtn) {
                    mobileLogoutBtn.onclick = () => {
                        localStorage.removeItem('customerToken');
                        checkAuthStatus();
                        updateCartCounter();
                        showNotification('Logged out successfully', 'success');
                    };
                }
            } else {
                // User is not logged in
                if (loginLink) loginLink.classList.remove('hidden');
                if (accountLink) accountLink.classList.add('hidden');
                if (logoutBtn) logoutBtn.classList.add('hidden');
                if (mobileLoginLink) mobileLoginLink.classList.remove('hidden');
                if (mobileAccountLink) mobileAccountLink.classList.add('hidden');
                if (mobileLogoutBtn) mobileLogoutBtn.classList.add('hidden');
                if (loginCta) loginCta.classList.remove('hidden');
                if (navLoginLink) navLoginLink.classList.remove('hidden');
                if (navAccountLink) navAccountLink.classList.add('hidden');
            }
        }
        
        // Check auth status on page load
        checkAuthStatus();

        // Load smart recommendations
        async function loadRecommendations() {
            try {
                const container = document.getElementById('recommendations-container');
                if (!container) return;

                // Get recently viewed products from localStorage
                const recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
                
                // Determine which API endpoint to use
                const token = localStorage.getItem('customerToken');
                const apiUrl = token ? '/api/recommendations' : '/api/recommendations/public';
                
                // Prepare query parameters
                const params = new URLSearchParams({
                    limit: 4,
                    recentlyViewed: JSON.stringify(recentlyViewed)
                });
                
                const response = await fetch(`${apiUrl}?${params}`, {
                    headers: token ? {
                        'Authorization': `Bearer ${token}`
                    } : {}
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('🎯 Recommendations loaded:', data);
                    
                    if (data.recommendations && data.recommendations.length > 0) {
                        displayRecommendations(data.recommendations);
                        return; // Successfully loaded recommendations
                    }
                }
                
                // If we get here, either the response wasn't ok or had no recommendations
                console.log('🔄 No recommendations from primary API, trying fallback...');
                
                // Fallback to popular products
                try {
                    const fallbackResponse = await fetch('/api/recommendations/public?limit=4');
                    if (fallbackResponse.ok) {
                        const fallbackData = await fallbackResponse.json();
                        if (fallbackData.recommendations && fallbackData.recommendations.length > 0) {
                            displayRecommendations(fallbackData.recommendations);
                            return; // Successfully loaded fallback recommendations
                        }
                    }
                } catch (fallbackError) {
                    console.error('❌ Fallback API also failed:', fallbackError);
                }
                
                // If both APIs fail, show ultimate fallback
                console.log('🔄 All APIs failed, showing ultimate fallback...');
                await showFallbackRecommendations();
                
            } catch (error) {
                console.error('❌ Error loading recommendations:', error);
                // Show fallback content
                await showFallbackRecommendations();
            }
        }

        // Display recommendations in the container
        function displayRecommendations(recommendations) {
            const container = document.getElementById('recommendations-container');
            if (!container) return;

            container.innerHTML = '';
            
            recommendations.forEach(product => {
                const recommendationCard = document.createElement('div');
                recommendationCard.className = 'glass-card rounded-xl overflow-hidden group cursor-pointer hover:scale-105 transition-transform duration-300';
                recommendationCard.onclick = () => {
                    // Store in recently viewed
                    const recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
                    if (!recentlyViewed.includes(product.id)) {
                        recentlyViewed.unshift(product.id);
                        if (recentlyViewed.length > 10) recentlyViewed.pop(); // Keep only 10
                        localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));
                    }
                    
                    // Navigate to product page
                    window.location.href = `product.html?id=${product.id}`;
                };

                const imageUrl = product.image_url || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjM0I0QjVCIi8+CjxwYXRoIGQ9Ik0yNSAyNUg3NVY3NUgyNVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+CjxwYXRoIGQ9Ik0zNSA0NUw2NSA0NU02NSA2NUwzNSA2NUwzNSA0NVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo=';
                
                recommendationCard.innerHTML = `
                    <img src="${imageUrl}" alt="${product.name}" class="w-full h-40 object-cover" loading="lazy" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjM0I0QjVCIi8+CjxwYXRoIGQ9Ik0yNSAyNUg3NVY3NUgyNVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+CjxwYXRoIGQ9Ik0zNSA0NUw2NSA0NU02NSA2NUwzNSA2NUwzNSA0NVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo='; this.onerror=null;">
                    <div class="p-4">
                        <h3 class="font-orbitron text-sm font-bold text-white mb-1">${product.name}</h3>
                        <p class="text-accent font-bold">$${(parseFloat(product.price) || 20.00).toFixed(2)}</p>
                        ${product.category ? `<p class="text-text-secondary text-xs mt-1">${product.category}</p>` : ''}
                    </div>
                `;
                
                container.appendChild(recommendationCard);
            });
        }

        // Show fallback recommendations if everything fails
        async function showFallbackRecommendations() {
            const container = document.getElementById('recommendations-container');
            if (!container) return;

            try {
                // Try to get random products from the main products API as ultimate fallback
                const response = await fetch('/api/products/public');
                if (response.ok) {
                    const products = await response.json();
                    if (products && products.length > 0) {
                        // Take first 4 products as fallback
                        const fallbackProducts = products.slice(0, 4);
                        displayRecommendations(fallbackProducts);
                        return;
                    }
                }
            } catch (fallbackError) {
                console.error('❌ Ultimate fallback also failed:', fallbackError);
            }

            // If everything fails, show a message instead of hardcoded placeholders
            container.innerHTML = `
                <div class="col-span-full text-center py-8">
                    <div class="glass-card rounded-xl p-8 max-w-md mx-auto">
                        <svg class="w-16 h-16 text-accent mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                        <h3 class="font-orbitron text-lg font-bold text-white mb-2">Loading Recommendations</h3>
                        <p class="text-text-secondary text-sm">We're preparing personalized suggestions for you...</p>
                        <div class="mt-4">
                            <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-accent"></div>
                        </div>
                    </div>
                </div>
            `;
        }

        // The smart recommendations system will now load real products or show a loading message
        console.log('✅ You Might Also Like section ready for dynamic loading');

        // Load recently viewed products
        async function loadRecentlyViewedProducts() {
            try {
                const container = document.getElementById('recently-viewed-products');
                if (!container) return;

                // Get recently viewed product IDs from localStorage
                const recentlyViewedIds = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
                
                if (recentlyViewedIds.length === 0) {
                    // No recently viewed products - show random products from database instead
                    console.log('🔄 No recently viewed products, loading random products as fallback...');
                    await loadRandomProductsAsFallback();
                    return;
                }

                // Fetch product details for recently viewed products
                const recentlyViewedProducts = [];
                for (const productId of recentlyViewedIds.slice(0, 6)) { // Show max 6 products
                    try {
                        const response = await fetch(`/api/products/public/${productId}`);
                        if (response.ok) {
                            const productData = await response.json();
                            const product = productData.product || productData;
                            recentlyViewedProducts.push(product);
                        }
                    } catch (error) {
                        console.error(`Error fetching product ${productId}:`, error);
                    }
                }

                if (recentlyViewedProducts.length === 0) {
                    // No products could be fetched - show message
                    container.innerHTML = `
                        <div class="flex-shrink-0 w-full text-center py-4">
                            <p class="text-text-secondary text-sm">No recently viewed products available</p>
                        </div>
                    `;
                    return;
                }

                // Display recently viewed products
                displayRecentlyViewedProducts(recentlyViewedProducts);

            } catch (error) {
                console.error('❌ Error loading recently viewed products:', error);
                await loadRandomProductsAsFallback();
            }
        }

        // Display recently viewed products
        function displayRecentlyViewedProducts(products) {
            const container = document.getElementById('recently-viewed-products');
            if (!container) return;

            console.log('🐛 DEBUG: displayRecentlyViewedProducts called with:', products);
            console.log('🐛 DEBUG: Products array length:', products.length);
            console.log('🐛 DEBUG: Products array type:', typeof products);
            console.log('🐛 DEBUG: Is products an array?', Array.isArray(products));
            
            // Clear container and add debugging info
            container.innerHTML = '';
            console.log('🐛 DEBUG: Container cleared, starting to add products...');
            
            // Ensure container is visible and has proper dimensions
            container.style.display = 'flex';
            container.style.visibility = 'visible';
            container.style.opacity = '1';
            container.style.minHeight = '120px'; // Ensure minimum height for products
            
            products.forEach((product, index) => {
                console.log(`🐛 DEBUG: Processing product ${index}:`, product);
                console.log(`🐛 DEBUG: Product image_url:`, product.image_url);
                const productThumbnail = document.createElement('div');
                productThumbnail.className = 'flex-shrink-0 w-20 cursor-pointer group';
                productThumbnail.style.minWidth = '80px'; // Ensure minimum width
                productThumbnail.style.display = 'block'; // Ensure display
                productThumbnail.onclick = () => {
                    // Navigate to product page
                    window.location.href = `product.html?id=${product.id}`;
                };

                const imageUrl = product.image_url || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjM0I0QjVCIi8+CjxwYXRoIGQ9Ik0yNSAyNUg3NVY3NUgyNVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+CjxwYXRoIGQ9Ik0zNSA0NUw2NSA0NU02NSA2NUwzNSA2NUwzNSA0NVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo=';
                console.log(`🐛 DEBUG: Final imageUrl for ${product.name}:`, imageUrl);
                
                productThumbnail.innerHTML = `
                    <div class="relative" style="width: 80px; height: 80px;">
                        <img src="${imageUrl}" alt="${product.name}" class="w-full h-20 object-cover rounded-lg group-hover:scale-105 transition-transform duration-300" loading="lazy" style="width: 80px; height: 80px;" onerror="console.error('❌ Recently viewed image failed to load:', this.src); this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjM0I0QjVCIi8+CjxwYXRoIGQ9Ik0yNSAyNUg3NVY3NUgyNVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+CjxwYXRoIGQ9Ik0zNSA0NUw2NSA0NU02NSA2NUwzNSA2NUwzNSA0NVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo='; this.onerror=null;" onload="console.log('✅ Recently viewed image loaded successfully:', this.src);">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300 rounded-lg"></div>
                    </div>
                    <div class="mt-2 text-center">
                        <p class="text-text-secondary text-xs truncate" title="${product.name}">${product.name}</p>
                        <p class="text-accent text-xs font-bold">$${(parseFloat(product.price) || 20.00).toFixed(2)}</p>
                    </div>
                `;
                
                container.appendChild(productThumbnail);
                console.log(`🐛 DEBUG: Added product ${index} to container. Container now has ${container.children.length} children`);
            });
            
            // Final debugging - check what's actually in the DOM
            console.log('🐛 DEBUG: Final container state:');
            console.log('🐛 DEBUG: Container children count:', container.children.length);
            console.log('🐛 DEBUG: Container innerHTML length:', container.innerHTML.length);
            console.log('🐛 DEBUG: Container classes:', container.className);
            console.log('🐛 DEBUG: Container computed styles:', window.getComputedStyle(container));
            console.log('🐛 DEBUG: Container offsetWidth:', container.offsetWidth);
            console.log('🐛 DEBUG: Container offsetHeight:', container.offsetHeight);
            console.log('🐛 DEBUG: Container clientWidth:', container.clientWidth);
            console.log('🐛 DEBUG: Container clientHeight:', container.clientHeight);
            
            // Check each child element
            Array.from(container.children).forEach((child, index) => {
                console.log(`🐛 DEBUG: Child ${index}:`, child);
                console.log(`🐛 DEBUG: Child ${index} classes:`, child.className);
                console.log(`🐛 DEBUG: Child ${index} computed styles:`, window.getComputedStyle(child));
                console.log(`🐛 DEBUG: Child ${index} offsetWidth:`, child.offsetWidth);
                console.log(`🐛 DEBUG: Child ${index} offsetHeight:`, child.offsetHeight);
            });
        }

        // Load random products as fallback for recently viewed section
        async function loadRandomProductsAsFallback() {
            try {
                const container = document.getElementById('recently-viewed-products');
                if (!container) return;

                console.log('🔄 Loading random products for recently viewed fallback...');
                
                // Try to get products from the main products API
                const response = await fetch('/api/products/public');
                if (response.ok) {
                    const products = await response.json();
                    console.log('🐛 DEBUG: Products from API:', products);
                    if (products && products.length > 0) {
                        // Take random products (up to 3 instead of 6)
                        const randomProducts = products
                            .sort(() => 0.5 - Math.random()) // Shuffle array
                            .slice(0, 3);
                        
                        console.log(`✅ Loaded ${randomProducts.length} random products for fallback`);
                        console.log('🐛 DEBUG: Random products for recently viewed:', randomProducts);
                        console.log('🐛 DEBUG: About to call displayRecentlyViewedProducts with:', randomProducts);
                        displayRecentlyViewedProducts(randomProducts);
                        return;
                    }
                }
                
                // If API fails, show hardcoded fallback
                console.log('❌ API failed, showing hardcoded fallback products');
                showHardcodedRecentlyViewedFallback();
                
            } catch (error) {
                console.error('❌ Error loading random products fallback:', error);
                showHardcodedRecentlyViewedFallback();
            }
        }

        // Show hardcoded fallback for recently viewed if everything fails
        function showHardcodedRecentlyViewedFallback() {
            const container = document.getElementById('recently-viewed-products');
            if (!container) return;

            container.innerHTML = `
                <!-- Hardcoded Fallback Product 1 -->
                <div class="flex-shrink-0 w-20 cursor-pointer group" onclick="window.location.href='shop.html'">
                    <div class="relative">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjM0I0QjVCIi8+CjxwYXRoIGQ9Ik0yNSAyNUg3NVY3NUgyNVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+CjxwYXRoIGQ9Ik0zNSA0NUw2NSA0NU02NSA2NUwzNSA2NUwzNSA0NVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo=" alt="Featured Product" class="w-full h-20 object-cover rounded-lg group-hover:scale-105 transition-transform duration-300">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300 rounded-lg"></div>
                    </div>
                    <div class="mt-2 text-center">
                        <p class="text-text-secondary text-xs truncate">Featured Product</p>
                        <p class="text-accent text-xs font-bold">$20.00</p>
                    </div>
                </div>

                <!-- Hardcoded Fallback Product 2 -->
                <div class="flex-shrink-0 w-20 cursor-pointer group" onclick="window.location.href='shop.html'">
                    <div class="relative">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjM0I0QjVCIi8+CjxwYXRoIGQ9Ik0yNSAyNUg3NVY3NUgyNVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+CjxwYXRoIGQ9Ik0zNSA0NUw2NSA0NU02NSA2NUwzNSA2NUwzNSA0NVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo=" alt="Popular Product" class="w-full h-20 object-cover rounded-lg group-hover:scale-105 transition-transform duration-300">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300 rounded-lg"></div>
                    </div>
                    <div class="mt-2 text-center">
                        <p class="text-text-secondary text-xs truncate">Popular Product</p>
                        <p class="text-accent text-xs font-bold">$20.00</p>
                    </div>
                </div>

                <!-- Hardcoded Fallback Product 3 -->
                <div class="flex-shrink-0 w-20 cursor-pointer group" onclick="window.location.href='shop.html'">
                    <div class="relative">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjM0I0QjVCIi8+CjxwYXRoIGQ9Ik0yNSAyNUg3NVY3NUgyNVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+CjxwYXRoIGQ9Ik0zNSA0NUw2NSA0NU02NSA2NUwzNSA2NUwzNSA0NVoiIHN0cm9rZT0iIzAwQkNENCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo=" alt="New Product" class="w-full h-20 object-cover rounded-lg group-hover:scale-105 transition-transform duration-300">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300 rounded-lg"></div>
                    </div>
                    <div class="mt-2 text-center">
                        <p class="text-text-secondary text-xs truncate">New Product</p>
                        <p class="text-accent text-xs font-bold">$20.00</p>
                    </div>
                </div>
            `;
        }

        // Size and Color filtering functionality
        let selectedSize = '';
        let selectedColor = '';
        
        // Add event listeners for size and color filters
        document.addEventListener('DOMContentLoaded', () => {
            const sizeFilter = document.getElementById('size-filter');
            const colorFilter = document.getElementById('color-filter');
            const clearFiltersBtn = document.getElementById('clear-filters-btn');
            
            // Remove duplicate color options if they exist
            if (colorFilter) {
                removeDuplicateColorOptions(colorFilter);
            }
            
            if (sizeFilter) {
                sizeFilter.addEventListener('change', () => {
                    selectedSize = sizeFilter.value;
                    console.log('🎯 Selected size filter:', selectedSize);
                    applyAllFilters();
                });
            }
            
            if (colorFilter) {
                colorFilter.addEventListener('change', () => {
                    selectedColor = colorFilter.value;
                    console.log('🎨 Selected color filter:', selectedColor);
                    applyAllFilters();
                });
            }
            
            if (clearFiltersBtn) {
                clearFiltersBtn.addEventListener('click', () => {
                    // Reset all filters
                    selectedSize = '';
                    selectedColor = '';
                    selectedCategories = ['All Designs'];
                    
                    // Reset UI
                    if (sizeFilter) sizeFilter.value = '';
                    if (colorFilter) colorFilter.value = '';
                    
                    // Reset category checkboxes
                    document.querySelectorAll('.category-checkbox').forEach(checkbox => {
                        checkbox.checked = checkbox.dataset.category === 'All Designs';
                    });
                    
                    console.log('🧹 All filters cleared');
                    resetFilters(); // Use our new resetFilters function instead of applyAllFilters
                });
            }
        });
        
        // Function to remove duplicate color options from a select element
        function removeDuplicateColorOptions(colorFilter) {
            console.log('🔍 Checking for duplicate color options in shop page...');
            const options = Array.from(colorFilter.options);
            const seenColors = new Set();
            const duplicates = [];
            
            options.forEach((option, index) => {
                const color = option.value;
                if (color && seenColors.has(color)) {
                    duplicates.push(option);
                    console.log(`    ❌ DUPLICATE FOUND: "${color}"`);
                } else if (color) {
                    seenColors.add(color);
                    console.log(`    ✅ Color: "${color}"`);
                }
            });
            
            // Remove duplicate elements
            duplicates.forEach(duplicate => {
                console.log(`🗑️ Removing duplicate: "${duplicate.value}"`);
                duplicate.remove();
            });
            
            if (duplicates.length > 0) {
                console.log(`🧹 Removed ${duplicates.length} duplicate color options`);
            } else {
                console.log(`✅ No duplicate color options found`);
            }
        }
        
        // Function to apply all filters (category, size, color)
        async function applyAllFilters() {
            try {
                let allFilteredProducts = [];
                
                // First, get products based on category filter
                if (selectedCategories.includes('All Designs')) {
                    const response = await fetch('/api/products/public');
                    if (response.ok) {
                        allFilteredProducts = await response.json();
                        console.log('🔍 Fetched all products:', allFilteredProducts.length);
                    }
                } else if (selectedCategories.length > 0) {
                    console.log('🔍 Fetching products for categories:', selectedCategories);
                    for (const category of selectedCategories) {
                        const apiUrl = `/api/products/public?category=${encodeURIComponent(category)}`;
                        console.log('🔍 Fetching from:', apiUrl);
                        const response = await fetch(apiUrl);
                        if (response.ok) {
                            const categoryProducts = await response.json();
                            console.log(`🔍 Category "${category}" returned ${categoryProducts.length} products:`, categoryProducts.map(p => ({ name: p.name, category: p.category })));
                            allFilteredProducts = [...allFilteredProducts, ...categoryProducts];
                        } else {
                            console.error(`❌ Failed to fetch category "${category}":`, response.status);
                        }
                    }
                    console.log('🔍 Total products after category filtering:', allFilteredProducts.length);
                    console.log('🔍 All fetched products:', allFilteredProducts.map(p => ({ name: p.name, category: p.category })));
                }
                
                // Then apply size and color filters to the results
                let finalFilteredProducts = allFilteredProducts.filter(product => {
                    let matchesSize = true;
                    let matchesColor = true;
                    
                    // Size filtering
                    if (selectedSize && selectedSize !== '') {
                        // Check if product has the selected size available
                        if (product.sizes && Array.isArray(product.sizes)) {
                            matchesSize = product.sizes.includes(selectedSize);
                        } else if (product.size_stock && typeof product.size_stock === 'object') {
                            matchesSize = product.size_stock.hasOwnProperty(selectedSize);
                        } else {
                            // If no size data, assume it matches (fallback)
                            matchesSize = true;
                        }
                    }
                    
                    // Color filtering
                    if (selectedColor && selectedColor !== '') {
                        // Check if product has the selected color available
                        if (product.colors && Array.isArray(product.colors)) {
                            matchesColor = product.colors.includes(selectedColor);
                        } else {
                            // If no color data, assume it matches (fallback)
                            matchesColor = true;
                        }
                    }
                    
                    return matchesSize && matchesColor;
                });
                
                console.log('🔍 Applying all filters:');
                console.log('   Categories:', selectedCategories);
                console.log('   Size:', selectedSize || 'All');
                console.log('   Color:', selectedColor || 'All');
                console.log(`   Results: ${finalFilteredProducts.length} of ${allFilteredProducts.length} products`);
                
                // Reset pagination
                currentPage = 0;
                totalPages = Math.ceil(finalFilteredProducts.length / productsPerPage);
                
                // Store filtered products globally for pagination
                filteredProducts = finalFilteredProducts;
                window.filteredProducts = finalFilteredProducts; // Also set on window for global access
                
                // Display filtered products
                displayProducts(0, finalFilteredProducts);
                updateProductCounts(finalFilteredProducts.length);
                
            } catch (error) {
                console.error('❌ Error applying filters:', error);
            }
        }

    </script>
<script id="dhws-dataInjector" src="/public/mobile-menu-injector.js?v=20250809d"></script>
<script>
  if (!window.__DHWS_INJECTOR_VERSION__) {
    var s = document.createElement('script');
    s.src = (location.pathname.includes('/pages/') ? '../public/mobile-menu-injector.js?v=20250809d' : 'public/mobile-menu-injector.js?v=20250809d');
    document.head.appendChild(s);
  }
</script>
</body>
</html>